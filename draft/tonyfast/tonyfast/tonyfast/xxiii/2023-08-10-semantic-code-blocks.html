<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>
   accessibile semantics for python code
  </title>
  <meta content="pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.
this leaves readers consuming preformatted text splattered with some color.
screen reader users with a stream of unstructured text despite the fact that programming languages
have richer semantics." name="description">
  <meta content="light" name="color-scheme">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js">
  </script>
  <script>
   (function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        
        var widgetRendererSrc = 'https://unpkg.com/@jupyter-js-widgets@*/dist/embed.js';
        
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
  </script>
  <style type="text/css">
   /* # accessible css configurations

we define these high level variables to allow for configuration during use and testing.
we are not sure what the preferred default values are for these any accessible notebooks features.
the variables specify critical degrees of freedom in the notebook style.

## notebook interface specific css variables

*/
:root {
    --nb-focus-width: 3px;
    --nb-accent-color: auto;
    --nb-margin: 5%;
    --nb-font-size: 16px;
    --nb-font-family: serif;
    --nb-line-height: 1.5;
    --nb-scrolled-height: 600px;
    --color-light: #FFFFFF;
    --color-dark: #2b2a33;
}


/* map css variables to css properties on the `body` elements.
this mapping turns out css variables into user interfaces. */

body {
    font-size: var(--nb-font-size);
    font-family: var(--nb-font-family);
    accent-color: var(--nb-accent-color);
    margin-left: var(--nb-margin);
    margin-right: var(--nb-margin);
    line-height: var(--nb-line-height);
    width: calc(100% - 2*var(--nb-margin));
    color: var(--color-dark);
    background-color: var(--color-light);
}

body.dark {
    color: var(--color-light);
    background-color: var(--color-dark);
}

main:fullscreen {
    overflow: auto;
    background: var(--color-light);
}

.dark main:fullscreen {
    background: var(--color-dark);
}

/* ## notebook settings

the notebook settings interface connects configurable css features to the user.
we use dialog elements to represents an element that should be hidden by default.
it turns out there are two ways to layout `dialog` elements. 
they can be used as modals or block elements.
we extract this dual purpose to provide both configurations to the user.

*/

dialog form>* {
    display: block;
}


/* ## wcag accessibility guidelines as a feature

flexibility is the future of assistive interfaces.
it is not in the purvey of privileged developers and inaccessible systems to decide what priority accessibility is.
it is the fucking priority.

in this implementation, we want to satisfy broad user needs by making a lot of features configurable.
one configurable feature is the accessibility priority. 
experienced developers may need less assistive features as they spend more time with an interface.

### buttons sizes

WCAG 2.1 defines a huge stinking AAA hit size for buttons. its beautiful.

/* satisfy AAA 2.5.5 */

.wcag-aaa button,
.wcag-aaa input[type=checkbox] {
    min-height: 44px;
    min-width: 44px;
}

.wcag-aaa a {
    font-size: max(44px, var(--nb-font-size));
}

/* WCAG 2.2 clarified a AA button size that is used to style checkboxes and buttons. */
/* satisfy AA 2.5.8 minimum target requirement */
.wcag-aa button,
.wcag-aa input[type=checkbox] {
    min-height: 24px;
    min-width: 24px;
}

.wcag-aa a {
    font-size: max(24px, var(--nb-font-size));
}

/* remove the color styling for AAA */
.wcag-aaa .highlight pre code span[class] {
    color: unset;
}

/* ### native textareas for AAA priority.


our AAA priority choices often ensure that third party libraries can not compromise the accessibility of notebook.
the design decisions are focused native elements so that the assistive technology users have consistent expectations and outcomes.

*/

.markdown textarea[name=source]+[role=group],
.wcag-a textarea[name=source],
.wcag-aa textarea[name=source],
.wcag-aaa .markdown textarea[name=source],
/* this group selector is very ambiguous */
.wcag-aaa textarea[name=source]+[role=group] {
    display: none;
}

/* line height cant change pre elements based on browser presets */
pre,
textarea {
    line-height: unset;
    white-space: pre-wrap;
}

.horiz-overflow pre,
.horiz-overflow textarea {
    white-space: pre;
}

/* this is only needed for the lsit template variant */
ol#cells {
    margin: unset;
    padding: unset;
}

li.cell {
    list-style-type: none;
}

/* ## notebook components layout */

td[role="none"]:not([hidden]),
th[role="none"]:not([hidden]) {
    display: block;
    text-align: unset;
}

table {
    border-spacing: unset;
}

#cells,
#cells .cell,
#cells>tbody {
    display: flex;
    flex-direction: column;
}

ol[reversed]#cells,
[reversed]#cells tbody {
    flex-direction: column-reverse;
}

/* hide the visual output area when there are no outputs. 
assistive technologies will recieve an audible notification that there are not outputs. */

fieldset[data-outputs="0"] {
    display: none;
}

/* ## modifications to html defaults 

### focus 

there nothing to be said about this topic that [sara soueidan](https://www.sarasoueidan.com/blog/focus-indicators/) hasn't said.
we start with her [universal focus recommendation](https://www.sarasoueidan.com/blog/focus-indicators/#a-%E2%80%98universal%E2%80%99-focus-indicator).

*/



.cell:focus-within,
:focus-visible {
    outline: max(var(--nb-focus-width), 1px) solid;
    box-shadow: 0 0 0 calc(2 * max(var(--nb-focus-width), 1px));
}


/* on firefox, the input and output become interactive when there is overflow. chrome fixed this recently find reference.*/
textarea[name=source] {
    min-width: 0;
}

td.nb-outputs,
td.nb-source {
    overflow-x: auto;
}

.horiz-overflow td.nb-outputs,
.horiz-overflow header,
.horiz-overflow footer {
    width: max-content;
}

.horiz-overflow td.nb-source {
    overflow-x: visible;
}

.horiz-overflow td.nb-outputs {
    min-width: 100%;
}

.horiz-overflow .cell {
    width: fit-content;
}

#nb-settings li::marker,
summary[inert]::marker {
    content: "";
}

/* ### inheriting styles */

input,
select,
button {
    font-family: inherit;
    font-size: inherit;
}

textarea {
    font-family: monospace;
    font-size: inherit;
    line-height: inherit;
    overflow: auto;
    color: unset;
}

textarea[name=source] {
    box-sizing: border-box;
    width: 100%;
    resize: none;
}


/* align checkboxes with buttons */
input[type="checkbox"] {
    vertical-align: middle;
}

/* ## custom class selectors */

#nb-dialogs details:not([open])~dialog:not([open]):not(:focus-within):not(:active),
/* legend:not(:focus-within):not(:active), */
details.log:not([open])+table,
.visually-hidden:not(:focus-within):not(:active),
.visually-hide {
    clip: rect(0 0 0 0);
    clip-path: inset(50%);
    height: 1px;
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: 1px;
}

.nb-outputs.nb-scrolled {
    max-height: var(--nb-scrolled-height);
    overflow-y: auto;
}

.nb-outputs.nb-collapsed {
    display: none;
}
  </style>
  <style id="nb-light-highlight" media="screen" type="text/css">
   /** accessible pygments github-light-high-contrast generated by __main__**/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #0969da4a }
.c { color: #66707b } /* Comment */
.err { color: #a0111f } /* Error */
.k { color: #a0111f } /* Keyword */
.l { color: #702c00 } /* Literal */
.n { color: #622cbc } /* Name */
.o { color: #024c1a } /* Operator */
.p { color: #24292f } /* Punctuation */
.ch { color: #66707b } /* Comment.Hashbang */
.cm { color: #66707b } /* Comment.Multiline */
.cp { color: #66707b } /* Comment.Preproc */
.cpf { color: #66707b } /* Comment.PreprocFile */
.c1 { color: #66707b } /* Comment.Single */
.cs { color: #66707b } /* Comment.Special */
.gd { color: #023b95 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #a0111f } /* Generic.Error */
.gh { color: #023b95 } /* Generic.Heading */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #023b95 } /* Generic.Subheading */
.kc { color: #023b95 } /* Keyword.Constant */
.kd { color: #a0111f } /* Keyword.Declaration */
.kn { color: #a0111f } /* Keyword.Namespace */
.kp { color: #a0111f } /* Keyword.Pseudo */
.kr { color: #a0111f } /* Keyword.Reserved */
.kt { color: #a0111f } /* Keyword.Type */
.ld { color: #702c00 } /* Literal.Date */
.m { color: #702c00 } /* Literal.Number */
.s { color: #023b95 } /* Literal.String */
.na { color: #702c00 } /* Name.Attribute */
.nb { color: #702c00 } /* Name.Builtin */
.nc { color: #023b95 } /* Name.Class */
.no { color: #023b95 } /* Name.Constant */
.nd { color: #702c00 } /* Name.Decorator */
.ni { color: #024c1a } /* Name.Entity */
.ne { color: #622cbc } /* Name.Exception */
.nf { color: #023b95 } /* Name.Function */
.nl { color: #702c00 } /* Name.Label */
.nn { color: #24292f } /* Name.Namespace */
.nx { color: #622cbc } /* Name.Other */
.py { color: #023b95 } /* Name.Property */
.nt { color: #024c1a } /* Name.Tag */
.nv { color: #702c00 } /* Name.Variable */
.ow { color: #622cbc } /* Operator.Word */
.pm { color: #24292f } /* Punctuation.Marker */
.w { color: #24292f } /* Text.Whitespace */
.mb { color: #702c00 } /* Literal.Number.Bin */
.mf { color: #702c00 } /* Literal.Number.Float */
.mh { color: #702c00 } /* Literal.Number.Hex */
.mi { color: #702c00 } /* Literal.Number.Integer */
.mo { color: #702c00 } /* Literal.Number.Oct */
.sa { color: #023b95 } /* Literal.String.Affix */
.sb { color: #023b95 } /* Literal.String.Backtick */
.sc { color: #023b95 } /* Literal.String.Char */
.dl { color: #023b95 } /* Literal.String.Delimiter */
.sd { color: #023b95 } /* Literal.String.Doc */
.s2 { color: #023b95 } /* Literal.String.Double */
.se { color: #023b95 } /* Literal.String.Escape */
.sh { color: #023b95 } /* Literal.String.Heredoc */
.si { color: #023b95 } /* Literal.String.Interpol */
.sx { color: #023b95 } /* Literal.String.Other */
.sr { color: #023b95 } /* Literal.String.Regex */
.s1 { color: #023b95 } /* Literal.String.Single */
.ss { color: #023b95 } /* Literal.String.Symbol */
.bp { color: #702c00 } /* Name.Builtin.Pseudo */
.fm { color: #023b95 } /* Name.Function.Magic */
.vc { color: #702c00 } /* Name.Variable.Class */
.vg { color: #702c00 } /* Name.Variable.Global */
.vi { color: #702c00 } /* Name.Variable.Instance */
.vm { color: #702c00 } /* Name.Variable.Magic */
.il { color: #702c00 } /* Literal.Number.Integer.Long */
  </style>
  <style id="nb-dark-highlight" media="not  screen" type="text/css">
   /** accessible pygments github-dark-high-contrast generated by __main__**/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #58a6ff70 }
.c { color: #d9dee3 } /* Comment */
.err { color: #ff9492 } /* Error */
.k { color: #ff9492 } /* Keyword */
.l { color: #ffb757 } /* Literal */
.n { color: #dbb7ff } /* Name */
.o { color: #72f088 } /* Operator */
.p { color: #C9D1D9 } /* Punctuation */
.ch { color: #d9dee3 } /* Comment.Hashbang */
.cm { color: #d9dee3 } /* Comment.Multiline */
.cp { color: #d9dee3 } /* Comment.Preproc */
.cpf { color: #d9dee3 } /* Comment.PreprocFile */
.c1 { color: #d9dee3 } /* Comment.Single */
.cs { color: #d9dee3 } /* Comment.Special */
.gd { color: #91cbff } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #ff9492 } /* Generic.Error */
.gh { color: #91cbff } /* Generic.Heading */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #91cbff } /* Generic.Subheading */
.kc { color: #91cbff } /* Keyword.Constant */
.kd { color: #ff9492 } /* Keyword.Declaration */
.kn { color: #ff9492 } /* Keyword.Namespace */
.kp { color: #ff9492 } /* Keyword.Pseudo */
.kr { color: #ff9492 } /* Keyword.Reserved */
.kt { color: #ff9492 } /* Keyword.Type */
.ld { color: #ffb757 } /* Literal.Date */
.m { color: #ffb757 } /* Literal.Number */
.s { color: #91cbff } /* Literal.String */
.na { color: #ffb757 } /* Name.Attribute */
.nb { color: #ffb757 } /* Name.Builtin */
.nc { color: #91cbff } /* Name.Class */
.no { color: #91cbff } /* Name.Constant */
.nd { color: #ffb757 } /* Name.Decorator */
.ni { color: #72f088 } /* Name.Entity */
.ne { color: #dbb7ff } /* Name.Exception */
.nf { color: #91cbff } /* Name.Function */
.nl { color: #ffb757 } /* Name.Label */
.nn { color: #C9D1D9 } /* Name.Namespace */
.nx { color: #dbb7ff } /* Name.Other */
.py { color: #91cbff } /* Name.Property */
.nt { color: #72f088 } /* Name.Tag */
.nv { color: #ffb757 } /* Name.Variable */
.ow { color: #dbb7ff } /* Operator.Word */
.pm { color: #C9D1D9 } /* Punctuation.Marker */
.w { color: #C9D1D9 } /* Text.Whitespace */
.mb { color: #ffb757 } /* Literal.Number.Bin */
.mf { color: #ffb757 } /* Literal.Number.Float */
.mh { color: #ffb757 } /* Literal.Number.Hex */
.mi { color: #ffb757 } /* Literal.Number.Integer */
.mo { color: #ffb757 } /* Literal.Number.Oct */
.sa { color: #91cbff } /* Literal.String.Affix */
.sb { color: #91cbff } /* Literal.String.Backtick */
.sc { color: #91cbff } /* Literal.String.Char */
.dl { color: #91cbff } /* Literal.String.Delimiter */
.sd { color: #91cbff } /* Literal.String.Doc */
.s2 { color: #91cbff } /* Literal.String.Double */
.se { color: #91cbff } /* Literal.String.Escape */
.sh { color: #91cbff } /* Literal.String.Heredoc */
.si { color: #91cbff } /* Literal.String.Interpol */
.sx { color: #91cbff } /* Literal.String.Other */
.sr { color: #91cbff } /* Literal.String.Regex */
.s1 { color: #91cbff } /* Literal.String.Single */
.ss { color: #91cbff } /* Literal.String.Symbol */
.bp { color: #ffb757 } /* Name.Builtin.Pseudo */
.fm { color: #91cbff } /* Name.Function.Magic */
.vc { color: #ffb757 } /* Name.Variable.Class */
.vg { color: #ffb757 } /* Name.Variable.Global */
.vi { color: #ffb757 } /* Name.Variable.Instance */
.vm { color: #ffb757 } /* Name.Variable.Magic */
.il { color: #ffb757 } /* Literal.Number.Integer.Long */
  </style>
  <!-- Load mathjax -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe">
  </script>
  <!-- MathJax configuration -->
  <script type="text/x-mathjax-config">
   init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
  </script>
  <!-- End of mathjax configuration -->
  <script type="module">
   document.addEventListener("DOMContentLoaded", async () => {
    const diagrams = document.querySelectorAll(".jp-Mermaid > pre.mermaid");
    // do not load mermaidjs if not needed
    if (!diagrams.length) {
      return;
    }
    const mermaid = (await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs")).default;
    const parser = new DOMParser();

    mermaid.initialize({
      maxTextSize: 100000,
      maxEdges: 100000,
      startOnLoad: false,
      fontFamily: window
        .getComputedStyle(document.body)
        .getPropertyValue("--jp-ui-font-family"),
      theme: document.querySelector("body[data-jp-theme-light='true']")
        ? "default"
        : "dark",
    });

    let _nextMermaidId = 0;

    function makeMermaidImage(svg) {
      const img = document.createElement("img");
      const doc = parser.parseFromString(svg, "image/svg+xml");
      const svgEl = doc.querySelector("svg");
      const { maxWidth } = svgEl?.style || {};
      const firstTitle = doc.querySelector("title");
      const firstDesc = doc.querySelector("desc");

      img.setAttribute("src", `data:image/svg+xml,${encodeURIComponent(svg)}`);
      if (maxWidth) {
        img.width = parseInt(maxWidth);
      }
      if (firstTitle) {
        img.setAttribute("alt", firstTitle.textContent);
      }
      if (firstDesc) {
        const caption = document.createElement("figcaption");
        caption.className = "sr-only";
        caption.textContent = firstDesc.textContent;
        return [img, caption];
      }
      return [img];
    }

    async function makeMermaidError(text) {
      let errorMessage = "";
      try {
        await mermaid.parse(text);
      } catch (err) {
        errorMessage = `${err}`;
      }

      const result = document.createElement("details");
      result.className = 'jp-RenderedMermaid-Details';
      const summary = document.createElement("summary");
      summary.className = 'jp-RenderedMermaid-Summary';
      const pre = document.createElement("pre");
      const code = document.createElement("code");
      code.innerText = text;
      pre.appendChild(code);
      summary.appendChild(pre);
      result.appendChild(summary);

      const warning = document.createElement("pre");
      warning.innerText = errorMessage;
      result.appendChild(warning);
      return [result];
    }

    async function renderOneMarmaid(src) {
      const id = `jp-mermaid-${_nextMermaidId++}`;
      const parent = src.parentNode;
      let raw = src.textContent.trim();
      const el = document.createElement("div");
      el.style.visibility = "hidden";
      document.body.appendChild(el);
      let results = null;
      let output = null;
      try {
        let { svg } = await mermaid.render(id, raw, el);
        svg = cleanMermaidSvg(svg);
        results = makeMermaidImage(svg);
        output = document.createElement("figure");
        results.map(output.appendChild, output);
      } catch (err) {
        parent.classList.add("jp-mod-warning");
        results = await makeMermaidError(raw);
        output = results[0];
      } finally {
        el.remove();
      }
      parent.classList.add("jp-RenderedMermaid");
      parent.appendChild(output);
    }


    /**
     * Post-process to ensure mermaid diagrams contain only valid SVG and XHTML.
     */
    function cleanMermaidSvg(svg) {
      return svg.replace(RE_VOID_ELEMENT, replaceVoidElement);
    }


    /**
     * A regular expression for all void elements, which may include attributes and
     * a slash.
     *
     * @see https://developer.mozilla.org/en-US/docs/Glossary/Void_element
     *
     * Of these, only `<br>` is generated by Mermaid in place of `\n`,
     * but _any_ "malformed" tag will break the SVG rendering entirely.
     */
    const RE_VOID_ELEMENT =
      /<\s*(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)\s*([^>]*?)\s*>/gi;

    /**
     * Ensure a void element is closed with a slash, preserving any attributes.
     */
    function replaceVoidElement(match, tag, rest) {
      rest = rest.trim();
      if (!rest.endsWith('/')) {
        rest = `${rest} /`;
      }
      return `<${tag} ${rest}>`;
    }

    void Promise.all([...diagrams].map(renderOneMarmaid));
  });
  </script>
  <style>
   .jp-Mermaid:not(.jp-RenderedMermaid) {
    display: none;
  }

  .jp-RenderedMermaid {
    overflow: auto;
    display: flex;
  }

  .jp-RenderedMermaid.jp-mod-warning {
    width: auto;
    padding: 0.5em;
    margin-top: 0.5em;
    border: var(--jp-border-width) solid var(--jp-warn-color2);
    border-radius: var(--jp-border-radius);
    color: var(--jp-ui-font-color1);
    font-size: var(--jp-ui-font-size1);
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .jp-RenderedMermaid figure {
    margin: 0;
    overflow: auto;
    max-width: 100%;
  }

  .jp-RenderedMermaid img {
    max-width: 100%;
  }

  .jp-RenderedMermaid-Details > pre {
    margin-top: 1em;
  }

  .jp-RenderedMermaid-Summary {
    color: var(--jp-warn-color2);
  }

  .jp-RenderedMermaid:not(.jp-mod-warning) pre {
    display: none;
  }

  .jp-RenderedMermaid-Summary > pre {
    display: inline-block;
    white-space: normal;
  }
  </style>
  <!-- End of mermaid configuration -->
 </head>
 <body class="wcag-aa">
  <header>
   <a href="#1" id="TOP">
    skip to main content
   </a>
   <br>
   <button accesskey="," aria-controls="nb-settings" onclick="openDialog()">
    settings
   </button>
   <button id="nb-fullscreen" onclick="fullScreen()">
    fullscreen
   </button>
   <p>
    <a aria-description="opens new tab" href="https://github.com/tonyfast" rel="me" style="font-size: bigger;" target="_blank">
     @tonyfast
    </a>
    s notebooks
   </p>
   <details>
    <summary>
     site navigation
    </summary>
    <nav>
     <ol>
      <li>
       <a href="../xxiv/2024-03-04-semantic-outputs.html">
        improved output semantic for python objects
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-03-01-notebook-accessibility-workshop.html">
        notebooks and accessibility workshop
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-03-01-a11y-list-string.ipynb.html">
        using microdata and semantic html to represent python objects
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-28-histograms-sucks.html">
        histograms suck
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-26-bash-midgy.html">
        adding shell and css fence directives to midgy
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-26-lunr-search.html">
        creating accessible search
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-26-multiindex-aria.html">
        adding aria to long or wide tables
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-21-build-docs-pd.html">
        build the site docs
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-20-multiindex-html.html">
        proper html tables with multiple indexes
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-15-pandas-table-names.html">
        a study of pandas dataframes with different levels
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-02-05-aiohttp-pandas-accessor.html">
        adding an http attribrute to pandas series
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-01-25-mast-a11y-notebooks.html">
        transforming mast notebooks into nbconvert templates.
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-01-20-colgroup-schema.html">
        semantic representation of columns based on schema
       </a>
      </li>
      <li>
       <a href="../xxiv/2024-01-05-docx-to-data.html">
        convertin a docx into a structured dataframe
       </a>
      </li>
      <li>
       <a href="2023-12-20-interactive-html-validation.html">
        interactive w3c validation
       </a>
      </li>
      <li>
       <a href="2023-12-15-a11y-testing-dimensions.html">
        slicing and dicing accessibility violations with exception groups
       </a>
      </li>
      <li>
       <a href="2023-12-13-jupyter-community-call.html">
        It's the Community Call Y'all
       </a>
      </li>
      <li>
       <a href="2023-12-08-vnu-validator-exceptions.html">
        generating higher resolution exceptions for the vnu validator
       </a>
      </li>
      <li>
       <a href="2023-12-03-axe-rules-topology.html">
        axe testing codes as dataframes and exceptions
       </a>
      </li>
      <li>
       <a href="2023-11-14-w3c-validator.html">
        running the w3c validator
       </a>
      </li>
      <li>
       <a href="2023-08-24-semantically-meaningful-displays.html">
        semantically meaningful display outputs for notebooks
       </a>
      </li>
      <li>
       <a href="2023-08-23-semantic-lits.html">
        semantically meaningful lists
       </a>
      </li>
      <li>
       <a href="2023-08-10-semantic-code-blocks.html">
        accessibile semantics for python code
       </a>
      </li>
      <li>
       <a href="2023-08-03-pandas-accessors.html">
        pandas accessors
       </a>
      </li>
      <li>
       <a href="2023-07-17-accessible-string-representations.html">
        the string is a samp
       </a>
      </li>
      <li>
       <a href="2023-06-26-dataframe-diagrams-figure-semantics.html">
        a semantic dataframe
       </a>
      </li>
      <li>
       <a href="2023-06-21-v7-aom.html">
        jupyter notebook v7 remediations
       </a>
      </li>
      <li>
       <a href="2023-03-18-ally-talk.html">
        A Crash Course in Digital Accessibility
       </a>
      </li>
      <li>
       <a href="2023-03-18-pycascades-ally-talk.html">
        A Crash Course in Digital Accessibility
       </a>
      </li>
      <li>
       <a href="2023-03-04-computational-notebooks-history.html">
        a sprint through history toward computional notebooks
       </a>
      </li>
      <li>
       <a href="2023-02-28-community-demo.html">
        pidgy literate computing
       </a>
      </li>
      <li>
       <a href="2023-02-19-semantic.html">
        semantic notebook structure
       </a>
      </li>
      <li>
       <a href="2023-02-05-pipings.html">
        pipes are common sugar
       </a>
      </li>
      <li>
       <a href="2023-01-24-whoosh-search.html">
        use whoosh to search cells/articles on disk
       </a>
      </li>
      <li>
       <a href="2023-01-24-system-dependency-graphs.html">
        extracting a dependency graph from importlib_metadata
       </a>
      </li>
      <li>
       <a href="2023-01-24-lite-build.html">
        including development builds in jupyter lite
       </a>
      </li>
      <li>
       <a href="2023-01-18-voila-pidgy-integration.html">
        cleaner integration of pidgy &amp; voila
       </a>
      </li>
      <li>
       <a href="2023-01-16-inspector-hack.html">
        customizing the IPython contextual help
       </a>
      </li>
      <li>
       <a href="2023-01-14-links-in-markdown-tokens.html">
        where do all the good links go?
       </a>
      </li>
      <li>
       <a href="2023-01-12-tree-sitter.html">
        getting start with tree sitter
       </a>
      </li>
      <li>
       <a href="2023-01-12-giscus-comments.html">
        adding giscus comments to this blog
       </a>
      </li>
      <li>
       <a href="2023-01-11-extensible-metadata.html">
        extensible metadata in the notebook format
       </a>
      </li>
      <li>
       <a href="2023-01-11-duckdb-search.html">
        full text search for notebooks and files using duckdb
       </a>
      </li>
      <li>
       <a href="2023-01-10-rara-gtfo.html">
        restart and run all or it didn't happen
       </a>
      </li>
      <li>
       <a href="2023-01-09-notebooks-states.html">
        three states of python in a notebook
       </a>
      </li>
      <li>
       <a href="2023-01-07-pidgy-voila.html">
        running pidgy in voila
       </a>
      </li>
      <li>
       <a href="2023-01-04-tfoot-dataframe.html">
        using tfoot in dataframes for more information
       </a>
      </li>
      <li>
       <a href="2023-01-04-using-diagrams.html">
        diagrams in jupyter and mkdocs
       </a>
      </li>
      <li>
       <a href="2023-01-02-accessible-dataframes-basic-indexes.html">
        rendering dataframes for screen readers with pandas
       </a>
      </li>
      <li>
       <a href="2023-01-01-strawberry-server.html">
        WIP: strawberry jupyter server
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-31-markdownish-notebook.html">
        a template for exporting markdownish notebooks
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-31-jupyter-config-files.html">
        configuration files
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-30-typer-magic.html">
        using typer in ipython magics
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-23-mkdocs-plugin.html">
        mkdocs plugin for jupyter notebooks
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-22-pyproject-analysis.html">
        analyzing pyproject.toml configurations of popular projects
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-21-lite-build.html">
        jupyterlite blog integration
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-20-pyscript-nbconvert.html">
        rendering a notebook with pyscript
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-19-integrating-typer.html">
        integrating typer into the blog
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-18-mkdocs-task.html">
        doit integration - a mkdocs example
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-17-find-dependencies-in-content.html">
        automating blog posts to work with jupyter-lite
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-16-issue-activity-graphql.html">
        retreiving my issue activity
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-15-html-tags-study.html">
        all the tags i could be using
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-13-github-api-stats.html">
        extracting info from the github statistics api
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-09-pyproject-analysis.html">
        exploring many pyproject.toml configs
       </a>
      </li>
      <li>
       <a href="../xxii/2022-12-05-markdown-to-doctest.html">
        formatting markdown it tokens as python doctests
       </a>
      </li>
      <li>
       <a href="../xxii/2022-11-26-package-mimic-and-rel-imports.html">
        making __main__ a __package__
       </a>
      </li>
      <li>
       <a href="../xxii/2022-11-23-better-dask-shape.html">
        unravel directories of notebooks with dask
       </a>
      </li>
      <li>
       <a href="../xxii/2022-11-17-assignment-expression-display.html">
        using assignment expressions to display and assign in IPython
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-11-17-assignment-expression-display.html">
        using assignment expressions to display and assign in IPython
       </a>
      </li>
      <li>
       <a href="../xxii/2022-11-12-async-import.html">
        asynchronous imports in python
       </a>
      </li>
      <li>
       <a href="../xxii/2022-11-12-pluggy-experiments.html">
        fumbling around with pluggy
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-29-metadata-formatter.html">
        inferring linked data from IPython run times.
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-27-axe-core-playwright-python.html">
        invoking axe-core from python playwright
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-25-static-notebook-tags.html">
        post processing html accessibility
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-21-markdown-future.html">
        when markdown and python collide
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-21-pidgy-displays.html">
        literate computing - interactive literate programming
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-20-meeting-link-widgets.html">
        making meeting links
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-19-mobius-text.html">
        turn some text into a mobius surface
       </a>
      </li>
      <li>
       <a href="../../xxii/oct/2022-10-05-dask-search.html">
        searching notebooks
       </a>
      </li>
      <li>
       <a href="../../../xxii/oct/colormap-dataframes/2021-10-11-colorizing.html">
        what do we learn when we make colormaps from dataframes
       </a>
      </li>
     </ol>
    </nav>
   </details>
   <section aria-labelledby="nb-summary-label">
    <details>
     <summary aria-describedby="nb-ct-total nb-cells-label nb-ct-code nb-state nb-ct-loc nb-loc-label
nb-ct-outputs nb-outputs-label" id="nb-summary-label">
      notebook summary
     </summary>
     <button aria-controls="nb-metadata" onclick="openDialog()">
      show metadata
     </button>
     <dl aria-labelledby="nb-summary-label">
      <dt>
       title
      </dt>
      <dd id="nb-title">
       accessibile semantics for python code
      </dd>
      <dt>
       description
      </dt>
      <dd id>
       pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.
this leaves readers consuming preformatted text splattered with some color.
screen reader users with a stream of unstructured text despite the fact that programming languages
have richer semantics.
      </dd>
      <dt>
       cells
      </dt>
      <dd id="nb-ct-total">
       29 total
      </dd>
      <dd id="nb-ct-code">
       15 code
      </dd>
      <dd>
      </dd>
      <dt>
       state
      </dt>
      <dd id="nb-state">
       executed in order
      </dd>
      <dt>
       language
      </dt>
      <dd id="nb-lang">
       python
      </dd>
      <dt id="nb-loc-label">
       lines of code
      </dt>
      <dd id="nb-ct-loc">
       172
      </dd>
      <dt>
       outputs
      </dt>
      <dd id="nb-ct-outputs">
       4
      </dd>
     </dl>
    </details>
   </section>
   <section aria-labelledby="nb-toc">
    <details open>
     <summary id="toc">
      <span id="nb-toc">
       table of contents
      </span>
     </summary>
     <a id="nb-toc-start">
     </a>
     <nav>
      <ol>
       <li>
        <a href="#None">
         accessibile semantics for python code
        </a>
       </li>
       <li>
        <ol>
         <li>
          <a href="#None">
           synthesizing multiple representations.
          </a>
         </li>
         <li>
          <a href="#None">
           capturing structure from the ast and tokenize
          </a>
         </li>
         <li>
          <ol>
           <li>
            <a href="#None">
             capturing nesting structure of the semantics with the ast module
            </a>
           </li>
           <li>
            <a href="#None">
             capturing comments with tokenize
            </a>
           </li>
          </ol>
         </li>
         <li>
          <a href="#None">
           custom pygments formatter
          </a>
         </li>
         <li>
          <a href="#None">
           more semantics by post processing the html
          </a>
         </li>
        </ol>
       </li>
       <li>
        <a href="#None">
         the modified highlighter in action
        </a>
       </li>
      </ol>
     </nav>
     <li>
      <a href="#None">
       a page/document of code
      </a>
     </li>
     <li>
      <a href="#None">
       flexible configuration
      </a>
     </li>
     <li>
      <a href="#None">
       conclusions
      </a>
     </li>
    </details>
   </section>
   <dialog id="nb-metadata">
    <form method="dialog">
     <button formmethod="dialog">
      Close
     </button>
     {"kernelspec": {"display_name": "base", "language": "python", "name": "base"}, "language_info": {"codemirror_mode": {"name": "ipython", "version": 3}, "file_extension": ".py", "mimetype": "text/x-python", "name": "python", "nbconvert_exporter": "python", "pygments_lexer": "ipython3", "version": "3.10.9"}, "widgets": {"application/vnd.jupyter.widget-state+json": {"state": {}, "version_major": 2, "version_minor": 0}}, "title": "accessibile semantics for python code", "description": "pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.\nthis leaves readers consuming preformatted text splattered with some color.\nscreen reader users with a stream of unstructured text despite the fact that programming languages\nhave richer semantics."}
    </form>
   </dialog>
  </header>
  <main>
   <table id="cells" role="none">
    <colgroup>
     <col class="nb-index">
     <col class="nb-execution_count">
     <col class="nb-cell_type">
     <col class="nb-toolbar">
     <col class="nb-started_at">
     <col class="nb-completed_at">
     <col class="nb-source">
     <col class="nb-loc">
     <col class="nb-metadata">
     <col class="nb-outputs">
    </colgroup>
    <tbody aria-labelledby="nb-notebook-label nb-cells-label" role="list">
     <tr hidden role="listitem">
      <th role="none" scope="col">
       index
      </th>
      <th role="none" scope="col">
       execution_count
      </th>
      <th role="none" scope="col">
       cell_type
      </th>
      <th role="none" scope="col">
       toolbar
      </th>
      <th role="none" scope="col">
       started_at
      </th>
      <th role="none" scope="col">
       completed_at
      </th>
      <th role="none" scope="col">
       source
      </th>
      <th role="none" scope="col">
       loc
      </th>
      <th role="none" scope="col">
       metadata
      </th>
      <th role="none" scope="col">
       outputs
      </th>
     </tr>
     <tr aria-labelledby="nb-cell-label 1 cell-1-cell_type" class="cell markdown" data-index="1" data-loc="16" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="1" aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 1" class="nb-anchor visually-hidden" href="#1" id="1">
        1
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-1-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-1-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-1-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-1-exec-label" class="nb-toolbar" hidden id="cell-1" name="cell-1">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-1-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-1-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-1-in-label cell-1-exec-label nb-source-label" class="nb-source" form="cell-1" id="cell-1-source" name="source" readonly rows="16"># accessibile semantics for python code

pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.
this leaves readers consuming preformatted text splattered with some color.
screen reader users with a stream of unstructured text despite the fact that programming languages
have richer semantics.

in this document, we consider a semantically meaningful representation of python code (this is not a general approach)
that aligns the structure of the annotation object model closer to the semantics of python programming language.
some flexible changes we'll propose are:

* function and class definition blocks are landmarks
* function and class definitions are headings
* top-level expressions/comments are grouped
  
in this document, we imagine an annotation object model for code that provides landmarks, headings, and other aria semantics.</textarea>
       <div aria-labelledby="cell-1-in-label cell-1-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gh"># accessibile semantics for python code</span>

pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.
this leaves readers consuming preformatted text splattered with some color.
screen reader users with a stream of unstructured text despite the fact that programming languages
have richer semantics.

in this document, we consider a semantically meaningful representation of python code (this is not a general approach)
that aligns the structure of the annotation object model closer to the semantics of python programming language.
some flexible changes we'll propose are:

<span class="k">*</span><span class="w"> </span>function and class definition blocks are landmarks
<span class="k">*</span><span class="w"> </span>function and class definitions are headings
<span class="k">*</span><span class="w"> </span>top-level expressions/comments are grouped
  
in this document, we imagine an annotation object model for code that provides landmarks, headings, and other aria semantics.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-1-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-1" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-1-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': "<h1><a href="#accessibile-semantics-for-python-code">accessibile semantics for python code</a></h1>\n<p>pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.\nthis leaves readers consuming preformatted text splattered with some color.\nscreen reader users with a stream of unstructured text despite the fact that programming languages\nhave richer semantics.</p>\n<p>in this document, we consider a semantically meaningful representation of python code (this is not a general approach)\nthat aligns the structure of the annotation object model closer to the semantics of python programming language.\nsome flexible changes we'll propose are:</p>\n<ul>\n<li>function and class definition blocks are landmarks</li>\n<li>function and class definitions are headings</li>\n<li>top-level expressions/comments are grouped</li>\n</ul>\n<p>in this document, we imagine an annotation object model for code that provides landmarks, headings, and other aria semantics.</p>\n"}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-1-loc" role="none">
       16
      </td>
      <td class="nb-outputs" role="none">
       <h1>
        <a href="#accessibile-semantics-for-python-code">
         accessibile semantics for python code
        </a>
       </h1>
       <p>
        pre-formatted html representations of code, in browse or focus mode, ignore the semantic of the source language.
this leaves readers consuming preformatted text splattered with some color.
screen reader users with a stream of unstructured text despite the fact that programming languages
have richer semantics.
       </p>
       <p>
        in this document, we consider a semantically meaningful representation of python code (this is not a general approach)
that aligns the structure of the annotation object model closer to the semantics of python programming language.
some flexible changes we'll propose are:
       </p>
       <ul>
        <li>
         function and class definition blocks are landmarks
        </li>
        <li>
         function and class definitions are headings
        </li>
        <li>
         top-level expressions/comments are grouped
        </li>
       </ul>
       <p>
        in this document, we imagine an annotation object model for code that provides landmarks, headings, and other aria semantics.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 2 cell-2-cell_type" class="cell code" data-index="2" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="2" aria-describedby="nb-code-label nb-cell-label cell-2-loc nb-loc-label
    cell-2-outputs-len" aria-labelledby="nb-cell-label 2" class="nb-anchor visually-hidden" href="#2" id="2">
        2
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-2-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-2-exec-label">
         1
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-2-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-2-exec-label" class="nb-toolbar" hidden id="cell-2" name="cell-2">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-2-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-2-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-2-in-label cell-2-exec-label nb-source-label" class="nb-source" form="cell-2" id="cell-2-source" name="source" readonly rows="1">    import pandas, ast, tokenize, pygments, io, inspect, itertools, html; from typing import *; from IPython.display import *; from functools import partial</textarea>
       <div aria-labelledby="cell-2-in-label cell-2-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="kn">import</span> <span class="nn">pandas</span><span class="o">,</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">tokenize</span><span class="o">,</span> <span class="nn">pygments</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">html</span><span class="p">;</span> <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-2-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-2" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-2-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-2-loc" role="none">
       1
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-2-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-2-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          1
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 3 cell-3-cell_type" class="cell markdown" data-index="3" data-loc="9" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="3" aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 3" class="nb-anchor visually-hidden" href="#3" id="3">
        3
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-3-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-3-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-3-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-3-exec-label" class="nb-toolbar" hidden id="cell-3" name="cell-3">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-3-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-3-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-3-in-label cell-3-exec-label nb-source-label" class="nb-source" form="cell-3" id="cell-3-source" name="source" readonly rows="9">## synthesizing multiple representations.

`pygments` is the primary way we display syntax highlighted code, it is a language agnostic tool.
to achieve our goals of a semantically meaningful code structure we need more details than `pygments` lexical analysis provides.

our semantic solution merges three streams of tokenized python source:
1. the `pygments` tokens provides html classes with reusable style sheets
2. the `ast` module provides nesting information of expressions
3. `tokenize` is used to discover comments in the python code because the `ast` module ignores them.</textarea>
       <div aria-labelledby="cell-3-in-label cell-3-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">## synthesizing multiple representations.</span>

<span class="sb">`pygments`</span> is the primary way we display syntax highlighted code, it is a language agnostic tool.
to achieve our goals of a semantically meaningful code structure we need more details than <span class="sb">`pygments`</span> lexical analysis provides.

our semantic solution merges three streams of tokenized python source:
<span class="k">1.</span> the <span class="sb">`pygments`</span> tokens provides html classes with reusable style sheets
<span class="k">2.</span> the <span class="sb">`ast`</span> module provides nesting information of expressions
<span class="k">3.</span> <span class="sb">`tokenize`</span> is used to discover comments in the python code because the <span class="sb">`ast`</span> module ignores them.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-3-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-3" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-3-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h2><a href="#synthesizing-multiple-representations">synthesizing multiple representations.</a></h2>\n<p><code>pygments</code> is the primary way we display syntax highlighted code, it is a language agnostic tool.\nto achieve our goals of a semantically meaningful code structure we need more details than <code>pygments</code> lexical analysis provides.</p>\n<p>our semantic solution merges three streams of tokenized python source:</p>\n<ol>\n<li>the <code>pygments</code> tokens provides html classes with reusable style sheets</li>\n<li>the <code>ast</code> module provides nesting information of expressions</li>\n<li><code>tokenize</code> is used to discover comments in the python code because the <code>ast</code> module ignores them.</li>\n</ol>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-3-loc" role="none">
       9
      </td>
      <td class="nb-outputs" role="none">
       <h2>
        <a href="#synthesizing-multiple-representations">
         synthesizing multiple representations.
        </a>
       </h2>
       <p>
        <code>
         pygments
        </code>
        is the primary way we display syntax highlighted code, it is a language agnostic tool.
to achieve our goals of a semantically meaningful code structure we need more details than
        <code>
         pygments
        </code>
        lexical analysis provides.
       </p>
       <p>
        our semantic solution merges three streams of tokenized python source:
       </p>
       <ol>
        <li>
         the
         <code>
          pygments
         </code>
         tokens provides html classes with reusable style sheets
        </li>
        <li>
         the
         <code>
          ast
         </code>
         module provides nesting information of expressions
        </li>
        <li>
         <code>
          tokenize
         </code>
         is used to discover comments in the python code because the
         <code>
          ast
         </code>
         module ignores them.
        </li>
       </ol>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 4 cell-4-cell_type" class="cell markdown" data-index="4" data-loc="5" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="4" aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 4" class="nb-anchor visually-hidden" href="#4" id="4">
        4
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-4-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-4-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-4-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-4-exec-label" class="nb-toolbar" hidden id="cell-4" name="cell-4">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-4-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-4-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-4-in-label cell-4-exec-label nb-source-label" class="nb-source" form="cell-4" id="cell-4-source" name="source" readonly rows="5">## capturing structure from the `ast` and `tokenize`

we use the `ast` module to capture the block nature of the python source code.
we synthesize the block line numbers with the `tokenize` tokens to capture comments, `ast` does not capture comments.
the line number and tag attributes are yielded for the regions of interest (eg expression and comment blocks) sorted by line number.</textarea>
       <div aria-labelledby="cell-4-in-label cell-4-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">## capturing structure from the `ast` and `tokenize`</span>

we use the <span class="sb">`ast`</span> module to capture the block nature of the python source code.
we synthesize the block line numbers with the <span class="sb">`tokenize`</span> tokens to capture comments, <span class="sb">`ast`</span> does not capture comments.
the line number and tag attributes are yielded for the regions of interest (eg expression and comment blocks) sorted by line number.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-4-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-4" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-4-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h2><a href="#capturing-structure-from-the-ast-and-tokenize">capturing structure from the ast and tokenize</a></h2>\n<p>we use the <code>ast</code> module to capture the block nature of the python source code.\nwe synthesize the block line numbers with the <code>tokenize</code> tokens to capture comments, <code>ast</code> does not capture comments.\nthe line number and tag attributes are yielded for the regions of interest (eg expression and comment blocks) sorted by line number.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-4-loc" role="none">
       5
      </td>
      <td class="nb-outputs" role="none">
       <h2>
        <a href="#capturing-structure-from-the-ast-and-tokenize">
         capturing structure from the ast and tokenize
        </a>
       </h2>
       <p>
        we use the
        <code>
         ast
        </code>
        module to capture the block nature of the python source code.
we synthesize the block line numbers with the
        <code>
         tokenize
        </code>
        tokens to capture comments,
        <code>
         ast
        </code>
        does not capture comments.
the line number and tag attributes are yielded for the regions of interest (eg expression and comment blocks) sorted by line number.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 5 cell-5-cell_type" class="cell code" data-index="5" data-loc="20" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="5" aria-describedby="nb-code-label nb-cell-label cell-5-loc nb-loc-label
    cell-5-outputs-len" aria-labelledby="nb-cell-label 5" class="nb-anchor visually-hidden" href="#5" id="5">
        5
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-5-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-5-exec-label">
         2
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-5-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-5-exec-label" class="nb-toolbar" hidden id="cell-5" name="cell-5">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-5-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-5-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-5-in-label cell-5-exec-label nb-source-label" class="nb-source" form="cell-5" id="cell-5-source" name="source" readonly rows="20">    def get_sorted_regions(source: str) -&gt; Iterator[tuple[int, dict]]:
        nodes: ast.AST = ast.parse(source)
        nested = []
        for i, s in sorted(itertools.chain(get_limits_from_ast(nodes), get_comments_from_tokenize(source))
                           , key=lambda x: (x[0], not bool(x[1]))):
            if s is not None:
                if isinstance(s, str):
                    nested.append(s)
                    dots = ".".join(filter(bool, nested))
                    yield i, dict(id=dots, role="region", **{"aria-label": dots})
                elif isinstance(s, ast.AST):
                    yield i, dict(id=F"{type(s).__name__}-L{s.lineno}", role="group", **{
                        "aria-label": F"{type(s).__name__} Line {s.lineno}"})
                    nested.append(None)
                elif isinstance(s, list):
                    yield i, dict(**{"aria-label": F"Comment Line {s[0].start[0]}"})
                    nested.append(None)
            else:
                nested and nested.pop()
                yield i, None</textarea>
       <div aria-labelledby="cell-5-in-label cell-5-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">get_sorted_regions</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span>
        <span class="n">nodes</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">nested</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">get_limits_from_ast</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="n">get_comments_from_tokenize</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
                           <span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">nested</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="n">dots</span> <span class="o">=</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">nested</span><span class="p">))</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">dots</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">"region"</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">"aria-label"</span><span class="p">:</span> <span class="n">dots</span><span class="p">})</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sa">F</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-L</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">"group"</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span>
                        <span class="s2">"aria-label"</span><span class="p">:</span> <span class="sa">F</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> Line </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">"</span><span class="p">})</span>
                    <span class="n">nested</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">"aria-label"</span><span class="p">:</span> <span class="sa">F</span><span class="s2">"Comment Line </span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">})</span>
                    <span class="n">nested</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nested</span> <span class="ow">and</span> <span class="n">nested</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">i</span><span class="p">,</span> <span class="kc">None</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-5-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-5" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-5-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-5-loc" role="none">
       20
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-5-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-5-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          2
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 6 cell-6-cell_type" class="cell markdown" data-index="6" data-loc="6" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="6" aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 6" class="nb-anchor visually-hidden" href="#6" id="6">
        6
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-6-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-6-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-6-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-6-exec-label" class="nb-toolbar" hidden id="cell-6" name="cell-6">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-6-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-6-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-6-in-label cell-6-exec-label nb-source-label" class="nb-source" form="cell-6" id="cell-6-source" name="source" readonly rows="6">### capturing nesting structure of the semantics with the `ast` module

the `ast` module allows us to capture the line numbers encapsulating expressions, functions and classes.
to add structure the semantics:
1. the top level expressions and statements in the module are grouped
2. all functions and classes are grouped</textarea>
       <div aria-labelledby="cell-6-in-label cell-6-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">### capturing nesting structure of the semantics with the `ast` module</span>

the <span class="sb">`ast`</span> module allows us to capture the line numbers encapsulating expressions, functions and classes.
to add structure the semantics:
<span class="k">1.</span> the top level expressions and statements in the module are grouped
<span class="k">2.</span> all functions and classes are grouped
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-6-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-6" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-6-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h3><a href="#capturing-nesting-structure-of-the-semantics-with-the-ast-module">capturing nesting structure of the semantics with the ast module</a></h3>\n<p>the <code>ast</code> module allows us to capture the line numbers encapsulating expressions, functions and classes.\nto add structure the semantics:</p>\n<ol>\n<li>the top level expressions and statements in the module are grouped</li>\n<li>all functions and classes are grouped</li>\n</ol>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-6-loc" role="none">
       6
      </td>
      <td class="nb-outputs" role="none">
       <h3>
        <a href="#capturing-nesting-structure-of-the-semantics-with-the-ast-module">
         capturing nesting structure of the semantics with the ast module
        </a>
       </h3>
       <p>
        the
        <code>
         ast
        </code>
        module allows us to capture the line numbers encapsulating expressions, functions and classes.
to add structure the semantics:
       </p>
       <ol>
        <li>
         the top level expressions and statements in the module are grouped
        </li>
        <li>
         all functions and classes are grouped
        </li>
       </ol>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 7 cell-7-cell_type" class="cell code" data-index="7" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="7" aria-describedby="nb-code-label nb-cell-label cell-7-loc nb-loc-label
    cell-7-outputs-len" aria-labelledby="nb-cell-label 7" class="nb-anchor visually-hidden" href="#7" id="7">
        7
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-7-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-7-exec-label">
         3
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-7-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-7-exec-label" class="nb-toolbar" hidden id="cell-7" name="cell-7">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-7-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-7-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-7-in-label cell-7-exec-label nb-source-label" class="nb-source" form="cell-7" id="cell-7-source" name="source" readonly rows="1">    def skip(n, x=None):  yield from (y for i, y in enumerate(x) if i &gt; n)</textarea>
       <div aria-labelledby="cell-7-in-label cell-7-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="k">yield from</span> <span class="p">(</span><span class="n">y</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-7-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-7" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-7-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-7-loc" role="none">
       1
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-7-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-7-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          3
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 8 cell-8-cell_type" class="cell code" data-index="8" data-loc="5" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="8" aria-describedby="nb-code-label nb-cell-label cell-8-loc nb-loc-label
    cell-8-outputs-len" aria-labelledby="nb-cell-label 8" class="nb-anchor visually-hidden" href="#8" id="8">
        8
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-8-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-8-exec-label">
         4
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-8-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-8-exec-label" class="nb-toolbar" hidden id="cell-8" name="cell-8">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-8-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-8-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-8-in-label cell-8-exec-label nb-source-label" class="nb-source" form="cell-8" id="cell-8-source" name="source" readonly rows="5">    def get_last_line(nodes):
        last = -1
        for x in skip(1, ast.walk(nodes)):
            last = max(getattr(x, "end_lineno", -1), last)
        return last</textarea>
       <div aria-labelledby="cell-8-in-label cell-8-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">get_last_line</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="n">last</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
            <span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">"end_lineno"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">last</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">last</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-8-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-8" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-8-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-8-loc" role="none">
       5
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-8-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-8-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          4
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 9 cell-9-cell_type" class="cell code" data-index="9" data-loc="6" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a accesskey="9" aria-describedby="nb-code-label nb-cell-label cell-9-loc nb-loc-label
    cell-9-outputs-len" aria-labelledby="nb-cell-label 9" class="nb-anchor visually-hidden" href="#9" id="9">
        9
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-9-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-9-exec-label">
         5
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-9-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-9-exec-label" class="nb-toolbar" hidden id="cell-9" name="cell-9">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-9-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-9-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-9-in-label cell-9-exec-label nb-source-label" class="nb-source" form="cell-9" id="cell-9-source" name="source" readonly rows="6">    def get_end(node):
        if node.lineno == node.end_lineno:
            return node.lineno-1, None
        if node.end_lineno == get_last_line(node):
            return node.end_lineno-1, None
        return node.end_lineno-2, None</textarea>
       <div aria-labelledby="cell-9-in-label cell-9-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span> <span class="o">==</span> <span class="n">get_last_line</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">end_lineno</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-9-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-9" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-9-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-9-loc" role="none">
       6
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-9-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-9-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          5
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 10 cell-10-cell_type" class="cell code" data-index="10" data-loc="12" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-10-loc nb-loc-label
    cell-10-outputs-len" aria-labelledby="nb-cell-label 10" class="nb-anchor visually-hidden" href="#10" id="10">
        10
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-10-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-10-exec-label">
         6
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-10-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-10-exec-label" class="nb-toolbar" hidden id="cell-10" name="cell-10">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-10-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-10-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-10-in-label cell-10-exec-label nb-source-label" class="nb-source" form="cell-10" id="cell-10-source" name="source" readonly rows="12">    def get_limits_from_ast(nodes: ast.AST) -&gt; Iterator[tuple[int, dict]]:
        for node in nodes.body:
            if isinstance(node, (ast.ClassDef, ast.AsyncFunctionDef, ast.FunctionDef)):
                yield node.lineno-1, node.name
                yield get_end(node)
            else:
                yield node.lineno-1, node
                yield get_end(node)
        for node in itertools.chain(*map(partial(skip, 1), map(ast.walk, nodes.body))):
            if isinstance(node, (ast.ClassDef, ast.AsyncFunctionDef, ast.FunctionDef)):
                yield node.lineno-1, node.name
                yield get_end(node)</textarea>
       <div aria-labelledby="cell-10-in-label cell-10-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">get_limits_from_ast</span><span class="p">(</span><span class="n">nodes</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
                <span class="k">yield</span> <span class="n">get_end</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">node</span>
                <span class="k">yield</span> <span class="n">get_end</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">map</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">body</span><span class="p">))):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
                <span class="k">yield</span> <span class="n">get_end</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-10-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-10" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-10-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-10-loc" role="none">
       12
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-10-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-10-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          6
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 11 cell-11-cell_type" class="cell markdown" data-index="11" data-loc="3" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 11" class="nb-anchor visually-hidden" href="#11" id="11">
        11
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-11-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-11-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-11-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-11-exec-label" class="nb-toolbar" hidden id="cell-11" name="cell-11">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-11-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-11-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-11-in-label cell-11-exec-label nb-source-label" class="nb-source" form="cell-11" id="cell-11-source" name="source" readonly rows="3">### capturing comments with `tokenize`

comments are effectively paragraphs in code. they should be more readable and specifically demarcated as non-code.</textarea>
       <div aria-labelledby="cell-11-in-label cell-11-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">### capturing comments with `tokenize`</span>

comments are effectively paragraphs in code. they should be more readable and specifically demarcated as non-code.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-11-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-11" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-11-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h3><a href="#capturing-comments-with-tokenize">capturing comments with tokenize</a></h3>\n<p>comments are effectively paragraphs in code. they should be more readable and specifically demarcated as non-code.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-11-loc" role="none">
       3
      </td>
      <td class="nb-outputs" role="none">
       <h3>
        <a href="#capturing-comments-with-tokenize">
         capturing comments with tokenize
        </a>
       </h3>
       <p>
        comments are effectively paragraphs in code. they should be more readable and specifically demarcated as non-code.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 12 cell-12-cell_type" class="cell code" data-index="12" data-loc="16" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-12-loc nb-loc-label
    cell-12-outputs-len" aria-labelledby="nb-cell-label 12" class="nb-anchor visually-hidden" href="#12" id="12">
        12
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-12-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-12-exec-label">
         7
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-12-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-12-exec-label" class="nb-toolbar" hidden id="cell-12" name="cell-12">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-12-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-12-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-12-in-label cell-12-exec-label nb-source-label" class="nb-source" form="cell-12" id="cell-12-source" name="source" readonly rows="16">    def get_comments_from_tokenize(source: str) -&gt; Iterator[tuple[int, dict]]:
        last = []
        for token in tokenize.tokenize(io.BytesIO(source.encode()).readline):
            if token.type == tokenize.NEWLINE:
                pass
            if token.type == tokenize.COMMENT:
                if last and (last[-1].start[0] + 1) &lt; token.start[0]:
                    yield last[0].start[0]-1, list(last)
                    yield last[-1].end[0]-1, None
                    last.clear()  
                if token.line.lstrip().startswith("#"):
                    last.append(token)
        if last and (last[-1].start[0] + 1) &lt; token.start[0]:
            yield last[0].start[0]-1, list(last)
            yield last[-1].end[0]-1, None
            last.clear()    
</textarea>
       <div aria-labelledby="cell-12-in-label cell-12-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">get_comments_from_tokenize</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span>
        <span class="n">last</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">readline</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">NEWLINE</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">COMMENT</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">yield</span> <span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">last</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="n">last</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  
                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"#"</span><span class="p">):</span>
                    <span class="n">last</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last</span> <span class="ow">and</span> <span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">last</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">last</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>    
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-12-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-12" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-12-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-12-loc" role="none">
       16
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-12-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-12-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          7
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 13 cell-13-cell_type" class="cell markdown" data-index="13" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 13" class="nb-anchor visually-hidden" href="#13" id="13">
        13
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-13-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-13-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-13-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-13-exec-label" class="nb-toolbar" hidden id="cell-13" name="cell-13">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-13-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-13-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-13-in-label cell-13-exec-label nb-source-label" class="nb-source" form="cell-13" id="cell-13-source" name="source" readonly rows="1">we extract docstrings so we use them to describe landmarks or links.</textarea>
       <div aria-labelledby="cell-13-in-label cell-13-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>we extract docstrings so we use them to describe landmarks or links.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-13-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-13" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-13-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<p>we extract docstrings so we use them to describe landmarks or links.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-13-loc" role="none">
       1
      </td>
      <td class="nb-outputs" role="none">
       <p>
        we extract docstrings so we use them to describe landmarks or links.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 14 cell-14-cell_type" class="cell markdown" data-index="14" data-loc="3" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 14" class="nb-anchor visually-hidden" href="#14" id="14">
        14
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-14-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-14-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-14-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-14-exec-label" class="nb-toolbar" hidden id="cell-14" name="cell-14">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-14-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-14-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-14-in-label cell-14-exec-label nb-source-label" class="nb-source" form="cell-14" id="cell-14-source" name="source" readonly rows="3">## custom `pygments` formatter

`pygments` drives the translation of source code to html. our custom renderer merges the `pygments`, `ast`, and `tokenize` streams together. the outcome is a semantically meaningfully representation of the code source.</textarea>
       <div aria-labelledby="cell-14-in-label cell-14-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">## custom `pygments` formatter</span>

<span class="sb">`pygments`</span> drives the translation of source code to html. our custom renderer merges the <span class="sb">`pygments`</span>, <span class="sb">`ast`</span>, and <span class="sb">`tokenize`</span> streams together. the outcome is a semantically meaningfully representation of the code source.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-14-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-14" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-14-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h2><a href="#custom-pygments-formatter">custom pygments formatter</a></h2>\n<p><code>pygments</code> drives the translation of source code to html. our custom renderer merges the <code>pygments</code>, <code>ast</code>, and <code>tokenize</code> streams together. the outcome is a semantically meaningfully representation of the code source.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-14-loc" role="none">
       3
      </td>
      <td class="nb-outputs" role="none">
       <h2>
        <a href="#custom-pygments-formatter">
         custom pygments formatter
        </a>
       </h2>
       <p>
        <code>
         pygments
        </code>
        drives the translation of source code to html. our custom renderer merges the
        <code>
         pygments
        </code>
        ,
        <code>
         ast
        </code>
        , and
        <code>
         tokenize
        </code>
        streams together. the outcome is a semantically meaningfully representation of the code source.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 15 cell-15-cell_type" class="cell code" data-index="15" data-loc="16" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-15-loc nb-loc-label
    cell-15-outputs-len" aria-labelledby="nb-cell-label 15" class="nb-anchor visually-hidden" href="#15" id="15">
        15
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-15-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-15-exec-label">
         8
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-15-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-15-exec-label" class="nb-toolbar" hidden id="cell-15" name="cell-15">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-15-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-15-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-15-in-label cell-15-exec-label nb-source-label" class="nb-source" form="cell-15" id="cell-15-source" name="source" readonly rows="16">    class Html(pygments.formatters.HtmlFormatter):
        def _format_lines(self, tokens):
            for j, (i, line) in enumerate(super()._format_lines(tokens), 1):
                while self.regions and j &gt; self.regions[0][0]:
                    m, n = self.regions.pop(0)
                    if n is None: 
                        line += ""
                    else:
                        attrs = " ".join(F'{k}="{v}"' for k, v in n.items())
                        line = F'''&lt;span {attrs}=""&gt;''' + line
                yield i , line
                
        def format(self, tokensource, outfile):
            tokensource = list(tokensource)
            self.regions = list(get_sorted_regions("".join(y for _, y in tokensource)))
            return super().format(tokensource, outfile)&lt;/span&gt;</textarea>
       <div aria-labelledby="cell-15-in-label cell-15-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">class</span> <span class="nc">Html</span><span class="p">(</span><span class="n">pygments</span><span class="o">.</span><span class="n">formatters</span><span class="o">.</span><span class="n">HtmlFormatter</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_format_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_format_lines</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                        <span class="n">line</span> <span class="o">+=</span> <span class="s2">"&lt;/span&gt;"</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">attrs</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">F</span><span class="s1">'</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">="</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">"'</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="sa">F</span><span class="s1">'''&lt;span </span><span class="si">{</span><span class="n">attrs</span><span class="si">}</span><span class="s1">&gt;'''</span> <span class="o">+</span> <span class="n">line</span>
                <span class="k">yield</span> <span class="n">i</span> <span class="p">,</span> <span class="n">line</span>
                
        <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokensource</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
            <span class="n">tokensource</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tokensource</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_sorted_regions</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tokensource</span><span class="p">)))</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tokensource</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-15-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-15" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-15-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-15-loc" role="none">
       16
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-15-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-15-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          8
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 16 cell-16-cell_type" class="cell markdown" data-index="16" data-loc="8" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 16" class="nb-anchor visually-hidden" href="#16" id="16">
        16
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-16-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-16-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-16-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-16-exec-label" class="nb-toolbar" hidden id="cell-16" name="cell-16">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-16-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-16-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-16-in-label cell-16-exec-label nb-source-label" class="nb-source" form="cell-16" id="cell-16-source" name="source" readonly rows="8">### more semantics by post processing the html

out of covenience, we add a post processing step to modify the highlighted html. these changes make:

* functions and classes headings
* functions and classes declarations links

the headings and links will now be included redundantly in screen reader navigation.</textarea>
       <div aria-labelledby="cell-16-in-label cell-16-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">### more semantics by post processing the html</span>

out of covenience, we add a post processing step to modify the highlighted html. these changes make:

<span class="k">*</span><span class="w"> </span>functions and classes headings
<span class="k">*</span><span class="w"> </span>functions and classes declarations links

the headings and links will now be included redundantly in screen reader navigation.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-16-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-16" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-16-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h3><a href="#more-semantics-by-post-processing-the-html">more semantics by post processing the html</a></h3>\n<p>out of covenience, we add a post processing step to modify the highlighted html. these changes make:</p>\n<ul>\n<li>functions and classes headings</li>\n<li>functions and classes declarations links</li>\n</ul>\n<p>the headings and links will now be included redundantly in screen reader navigation.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-16-loc" role="none">
       8
      </td>
      <td class="nb-outputs" role="none">
       <h3>
        <a href="#more-semantics-by-post-processing-the-html">
         more semantics by post processing the html
        </a>
       </h3>
       <p>
        out of covenience, we add a post processing step to modify the highlighted html. these changes make:
       </p>
       <ul>
        <li>
         functions and classes headings
        </li>
        <li>
         functions and classes declarations links
        </li>
       </ul>
       <p>
        the headings and links will now be included redundantly in screen reader navigation.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 17 cell-17-cell_type" class="cell code" data-index="17" data-loc="9" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-17-loc nb-loc-label
    cell-17-outputs-len" aria-labelledby="nb-cell-label 17" class="nb-anchor visually-hidden" href="#17" id="17">
        17
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-17-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-17-exec-label">
         9
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-17-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-17-exec-label" class="nb-toolbar" hidden id="cell-17" name="cell-17">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-17-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-17-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-17-in-label cell-17-exec-label nb-source-label" class="nb-source" form="cell-17" id="cell-17-source" name="source" readonly rows="9">    def post_highlight(html):
        soup = __import__("bs4").BeautifulSoup(html, features="html.parser")
        for name in soup.select(".k+.nf,.k+.nc,.k+.fm"):
            id = name.parent.attrs.get("id") or ""
            if id:
                a = soup.new_tag("a")
                a.attrs.update(href="#"+id, role="heading", **{"aria-level": id.count(".")+2})
                a.extend(name.children), name.clear(), name.append(a)
        return soup.prettify()</textarea>
       <div aria-labelledby="cell-17-in-label cell-17-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">post_highlight</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s2">"bs4"</span><span class="p">)</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s2">"html.parser"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">".k+.nf,.k+.nc,.k+.fm"</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">""</span>
            <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">new_tag</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">+</span><span class="nb">id</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">"heading"</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">"aria-level"</span><span class="p">:</span> <span class="nb">id</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">})</span>
                <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">children</span><span class="p">),</span> <span class="n">name</span><span class="o">.</span><span class="n">clear</span><span class="p">(),</span> <span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">soup</span><span class="o">.</span><span class="n">prettify</span><span class="p">()</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-17-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-17" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-17-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-17-loc" role="none">
       9
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-17-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-17-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          9
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 18 cell-18-cell_type" class="cell markdown" data-index="18" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 18" class="nb-anchor visually-hidden" href="#18" id="18">
        18
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-18-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-18-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-18-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-18-exec-label" class="nb-toolbar" hidden id="cell-18" name="cell-18">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-18-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-18-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-18-in-label cell-18-exec-label nb-source-label" class="nb-source" form="cell-18" id="cell-18-source" name="source" readonly rows="1">## the modified highlighter in action</textarea>
       <div aria-labelledby="cell-18-in-label cell-18-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">## the modified highlighter in action</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-18-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-18" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-18-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h2><a href="#the-modified-highlighter-in-action">the modified highlighter in action</a></h2>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-18-loc" role="none">
       1
      </td>
      <td class="nb-outputs" role="none">
       <h2>
        <a href="#the-modified-highlighter-in-action">
         the modified highlighter in action
        </a>
       </h2>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 19 cell-19-cell_type" class="cell markdown" data-index="19" data-loc="3" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 19" class="nb-anchor visually-hidden" href="#19" id="19">
        19
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-19-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-19-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-19-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-19-exec-label" class="nb-toolbar" hidden id="cell-19" name="cell-19">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-19-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-19-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-19-in-label cell-19-exec-label nb-source-label" class="nb-source" form="cell-19" id="cell-19-source" name="source" readonly rows="3">our `sample` source is randomly taken as the source of the `tokenize` module. _if this notebook is live then you can change the source._

we include accessible `pygments` themes extended from eric bailey's accessible theme palettes.</textarea>
       <div aria-labelledby="cell-19-in-label cell-19-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>our <span class="sb">`sample`</span> source is randomly taken as the source of the <span class="sb">`tokenize`</span> module. <span class="ge">_if this notebook is live then you can change the source._</span>

we include accessible <span class="sb">`pygments`</span> themes extended from eric bailey's accessible theme palettes.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-19-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-19" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-19-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': "<p>our <code>sample</code> source is randomly taken as the source of the <code>tokenize</code> module. <em>if this notebook is live then you can change the source.</em></p>\n<p>we include accessible <code>pygments</code> themes extended from eric bailey's accessible theme palettes.</p>\n"}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-19-loc" role="none">
       3
      </td>
      <td class="nb-outputs" role="none">
       <p>
        our
        <code>
         sample
        </code>
        source is randomly taken as the source of the
        <code>
         tokenize
        </code>
        module.
        <em>
         if this notebook is live then you can change the source.
        </em>
       </p>
       <p>
        we include accessible
        <code>
         pygments
        </code>
        themes extended from eric bailey's accessible theme palettes.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 20 cell-20-cell_type" class="cell code" data-index="20" data-loc="4" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-20-loc nb-loc-label
    cell-20-outputs-len" aria-labelledby="nb-cell-label 20" class="nb-anchor visually-hidden" href="#20" id="20">
        20
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-20-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-20-exec-label">
         10
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-20-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-20-exec-label" class="nb-toolbar" hidden id="cell-20" name="cell-20">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-20-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-20-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-20-in-label cell-20-exec-label nb-source-label" class="nb-source" form="cell-20" id="cell-20-source" name="source" readonly rows="4">    sample = inspect.getsource(tokenize)
    formatter = Html(style="github-light-high-contrast")
    page = post_highlight(pygments.highlight(sample, pygments.lexers.get_lexer_by_name("python"), formatter))
    HTML(F"""&lt;details&gt;&lt;summary&gt;expand this to see the  highlighted code &lt;/summary&gt;{page}&lt;/details&gt;""")</textarea>
       <div aria-labelledby="cell-20-in-label cell-20-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="n">sample</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">tokenize</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">Html</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"github-light-high-contrast"</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">post_highlight</span><span class="p">(</span><span class="n">pygments</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">pygments</span><span class="o">.</span><span class="n">lexers</span><span class="o">.</span><span class="n">get_lexer_by_name</span><span class="p">(</span><span class="s2">"python"</span><span class="p">),</span> <span class="n">formatter</span><span class="p">))</span>
    <span class="n">HTML</span><span class="p">(</span><span class="sa">F</span><span class="s2">"""&lt;details&gt;&lt;summary&gt;expand this to see the  highlighted code &lt;/summary&gt;</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&lt;/details&gt;"""</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-20-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-20" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-20-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-20-loc" role="none">
       4
      </td>
      <td class="nb-outputs" role="none">
       <span class="nb-outputs visually-hidden" id="cell-20-outputs-len">
        1 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="1">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-20-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          10
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
        <details>
         <summary>
          expand this to see the  highlighted code
         </summary>
         <div class="highlight">
          <pre><span></span><span aria-label="Expr Line 1" id="Expr-L1" role="group"><span class="sd">"""Tokenization help for Python programs.</span>

<span class="sd">tokenize(readline) is a generator that breaks a stream of bytes into</span>
<span class="sd">Python tokens.  It decodes the bytes according to PEP-0263 for</span>
<span class="sd">determining source file encoding.</span>

<span class="sd">It accepts a readline-like method which is called repeatedly to get the</span>
<span class="sd">next line of input (or b"" for EOF).  It generates 5-tuples with these</span>
<span class="sd">members:</span>

<span class="sd">    the token type (see token.py)</span>
<span class="sd">    the token (a string)</span>
<span class="sd">    the starting (row, column) indices of the token (a 2-tuple of ints)</span>
<span class="sd">    the ending (row, column) indices of the token (a 2-tuple of ints)</span>
<span class="sd">    the original line (string)</span>

<span class="sd">It is designed to match the working of the Python tokenizer exactly, except</span>
<span class="sd">that it produces COMMENT tokens for comments and gives type OP for all</span>
<span class="sd">operators.  Additionally, all token lists start with an ENCODING token</span>
<span class="sd">which tells you which encoding was used to decode the bytes stream.</span>
</span><span class="sd">"""</span>

<span aria-label="Assign Line 23" id="Assign-L23" role="group"><span class="n">__author__</span> <span class="o">=</span> <span class="s1">'Ka-Ping Yee &lt;ping@lfw.org&gt;'</span>
</span><span aria-label="Assign Line 24" id="Assign-L24" role="group"><span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'GvR, ESR, Tim Peters, Thomas Wouters, Fred Drake, '</span>
               <span class="s1">'Skip Montanaro, Raymond Hettinger, Trent Nelson, '</span>
               <span class="s1">'Michael Foord'</span><span class="p">)</span>
</span><span aria-label="ImportFrom Line 27" id="ImportFrom-L27" role="group"><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">open</span> <span class="k">as</span> <span class="n">_builtin_open</span>
</span><span aria-label="ImportFrom Line 28" id="ImportFrom-L28" role="group"><span class="kn">from</span> <span class="nn">codecs</span> <span class="kn">import</span> <span class="n">lookup</span><span class="p">,</span> <span class="n">BOM_UTF8</span>
</span><span aria-label="Import Line 29" id="Import-L29" role="group"><span class="kn">import</span> <span class="nn">collections</span>
</span><span aria-label="Import Line 30" id="Import-L30" role="group"><span class="kn">import</span> <span class="nn">functools</span>
</span><span aria-label="ImportFrom Line 31" id="ImportFrom-L31" role="group"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">TextIOWrapper</span>
</span><span aria-label="Import Line 32" id="Import-L32" role="group"><span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">_itertools</span>
</span><span aria-label="Import Line 33" id="Import-L33" role="group"><span class="kn">import</span> <span class="nn">re</span>
</span><span aria-label="Import Line 34" id="Import-L34" role="group"><span class="kn">import</span> <span class="nn">sys</span>
</span><span aria-label="ImportFrom Line 35" id="ImportFrom-L35" role="group"><span class="kn">from</span> <span class="nn">token</span> <span class="kn">import</span> <span class="o">*</span>
</span><span aria-label="ImportFrom Line 36" id="ImportFrom-L36" role="group"><span class="kn">from</span> <span class="nn">token</span> <span class="kn">import</span> <span class="n">EXACT_TOKEN_TYPES</span>
</span>
<span aria-label="Assign Line 38" id="Assign-L38" role="group"><span class="n">cookie_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">'^[ \t\f]*#.*?coding[:=][ \t]*([-\w.]+)'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
</span><span aria-label="Assign Line 39" id="Assign-L39" role="group"><span class="n">blank_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">br</span><span class="s1">'^[ \t\f]*(?:[#\r\n]|$)'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
</span>
<span aria-label="Import Line 41" id="Import-L41" role="group"><span class="kn">import</span> <span class="nn">token</span>
</span><span aria-label="Assign Line 42" id="Assign-L42" role="group"><span class="n">__all__</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">__all__</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"tokenize"</span><span class="p">,</span> <span class="s2">"generate_tokens"</span><span class="p">,</span> <span class="s2">"detect_encoding"</span><span class="p">,</span>
                           <span class="s2">"untokenize"</span><span class="p">,</span> <span class="s2">"TokenInfo"</span><span class="p">]</span>
</span><span aria-label="Delete Line 44" id="Delete-L44" role="group"><span class="k">del</span> <span class="n">token</span>
</span>
<span aria-label="TokenInfo" id="TokenInfo" role="region"><span class="k">class</span> <span class="nc"><a aria-level="2" href="#TokenInfo" role="heading">TokenInfo</a></span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'TokenInfo'</span><span class="p">,</span> <span class="s1">'type string start end line'</span><span class="p">)):</span>
<span aria-label="TokenInfo.__repr__" id="TokenInfo.__repr__" role="region">    <span class="k">def</span> <span class="fm"><a aria-level="3" href="#TokenInfo.__repr__" role="heading">__repr__</a></span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">annotated_type</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%d</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">tok_name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">'TokenInfo(type=</span><span class="si">%s</span><span class="s1">, string=</span><span class="si">%r</span><span class="s1">, start=</span><span class="si">%r</span><span class="s1">, end=</span><span class="si">%r</span><span class="s1">, line=</span><span class="si">%r</span><span class="s1">)'</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">annotated_type</span><span class="p">))</span>
</span>
    <span class="nd">@property</span>
<span aria-label="TokenInfo.exact_type" id="TokenInfo.exact_type" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#TokenInfo.exact_type" role="heading">exact_type</a></span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">OP</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="ow">in</span> <span class="n">EXACT_TOKEN_TYPES</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EXACT_TOKEN_TYPES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</span></span>
<span aria-label="group" id="group" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#group" role="heading">group</a></span><span class="p">(</span><span class="o">*</span><span class="n">choices</span><span class="p">):</span> <span class="k">return</span> <span class="s1">'('</span> <span class="o">+</span> <span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="o">+</span> <span class="s1">')'</span>
</span><span aria-label="any" id="any" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#any" role="heading">any</a></span><span class="p">(</span><span class="o">*</span><span class="n">choices</span><span class="p">):</span> <span class="k">return</span> <span class="n">group</span><span class="p">(</span><span class="o">*</span><span class="n">choices</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'*'</span>
</span><span aria-label="maybe" id="maybe" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#maybe" role="heading">maybe</a></span><span class="p">(</span><span class="o">*</span><span class="n">choices</span><span class="p">):</span> <span class="k">return</span> <span class="n">group</span><span class="p">(</span><span class="o">*</span><span class="n">choices</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'?'</span>
</span>
<span aria-label="Comment Line 63"><span class="c1"># Note: we use unicode matching for names ("\w") but ascii matching for</span>
<span class="c1"># number literals.</span>
</span><span aria-label="Assign Line 65" id="Assign-L65" role="group"><span class="n">Whitespace</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[ \f\t]*'</span>
</span><span aria-label="Assign Line 66" id="Assign-L66" role="group"><span class="n">Comment</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'#[^\r\n]*'</span>
</span><span aria-label="Assign Line 67" id="Assign-L67" role="group"><span class="n">Ignore</span> <span class="o">=</span> <span class="n">Whitespace</span> <span class="o">+</span> <span class="nb">any</span><span class="p">(</span><span class="sa">r</span><span class="s1">'</span><span class="se">\\</span><span class="s1">\r?\n'</span> <span class="o">+</span> <span class="n">Whitespace</span><span class="p">)</span> <span class="o">+</span> <span class="n">maybe</span><span class="p">(</span><span class="n">Comment</span><span class="p">)</span>
</span><span aria-label="Assign Line 68" id="Assign-L68" role="group"><span class="n">Name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'\w+'</span>
</span>
<span aria-label="Assign Line 70" id="Assign-L70" role="group"><span class="n">Hexnumber</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'0[xX](?:_?[0-9a-fA-F])+'</span>
</span><span aria-label="Assign Line 71" id="Assign-L71" role="group"><span class="n">Binnumber</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'0[bB](?:_?[01])+'</span>
</span><span aria-label="Assign Line 72" id="Assign-L72" role="group"><span class="n">Octnumber</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'0[oO](?:_?[0-7])+'</span>
</span><span aria-label="Assign Line 73" id="Assign-L73" role="group"><span class="n">Decnumber</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'(?:0(?:_?0)*|[1-9](?:_?[0-9])*)'</span>
</span><span aria-label="Assign Line 74" id="Assign-L74" role="group"><span class="n">Intnumber</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">Hexnumber</span><span class="p">,</span> <span class="n">Binnumber</span><span class="p">,</span> <span class="n">Octnumber</span><span class="p">,</span> <span class="n">Decnumber</span><span class="p">)</span>
</span><span aria-label="Assign Line 75" id="Assign-L75" role="group"><span class="n">Exponent</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[eE][-+]?[0-9](?:_?[0-9])*'</span>
</span><span aria-label="Assign Line 76" id="Assign-L76" role="group"><span class="n">Pointfloat</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[0-9](?:_?[0-9])*\.(?:[0-9](?:_?[0-9])*)?'</span><span class="p">,</span>
                   <span class="sa">r</span><span class="s1">'\.[0-9](?:_?[0-9])*'</span><span class="p">)</span> <span class="o">+</span> <span class="n">maybe</span><span class="p">(</span><span class="n">Exponent</span><span class="p">)</span>
</span><span aria-label="Assign Line 78" id="Assign-L78" role="group"><span class="n">Expfloat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[0-9](?:_?[0-9])*'</span> <span class="o">+</span> <span class="n">Exponent</span>
</span><span aria-label="Assign Line 79" id="Assign-L79" role="group"><span class="n">Floatnumber</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">Pointfloat</span><span class="p">,</span> <span class="n">Expfloat</span><span class="p">)</span>
</span><span aria-label="Assign Line 80" id="Assign-L80" role="group"><span class="n">Imagnumber</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[0-9](?:_?[0-9])*[jJ]'</span><span class="p">,</span> <span class="n">Floatnumber</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'[jJ]'</span><span class="p">)</span>
</span><span aria-label="Assign Line 81" id="Assign-L81" role="group"><span class="n">Number</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">Imagnumber</span><span class="p">,</span> <span class="n">Floatnumber</span><span class="p">,</span> <span class="n">Intnumber</span><span class="p">)</span>
</span>
<span aria-label="Comment Line 83"><span class="c1"># Return the empty string, plus all of the valid string prefixes.</span>
</span><span aria-label="_all_string_prefixes" id="_all_string_prefixes" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#_all_string_prefixes" role="heading">_all_string_prefixes</a></span><span class="p">():</span>
<span aria-label="Comment Line 85">    <span class="c1"># The valid string prefixes. Only contain the lower case versions,</span>
    <span class="c1">#  and don't contain any permutations (include 'fr', but not</span>
    <span class="c1">#  'rf'). The various permutations will be generated.</span>
</span>    <span class="n">_valid_string_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'br'</span><span class="p">,</span> <span class="s1">'fr'</span><span class="p">]</span>
<span aria-label="Comment Line 89">    <span class="c1"># if we add binary f-strings, add: ['fb', 'fbr']</span>
</span>    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">''</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">_valid_string_prefixes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
<span aria-label="Comment Line 93">            <span class="c1"># create a list with upper and lower versions of each</span>
            <span class="c1">#  character</span>
</span>            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">_itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</span>
<span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span>
<span aria-label="_compile" id="_compile" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#_compile" role="heading">_compile</a></span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
</span>
<span aria-label="Comment Line 103"><span class="c1"># Note that since _all_string_prefixes includes the empty string,</span>
<span class="c1">#  StringPrefix can be the empty string (making it optional).</span>
</span><span aria-label="Assign Line 105" id="Assign-L105" role="group"><span class="n">StringPrefix</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="o">*</span><span class="n">_all_string_prefixes</span><span class="p">())</span>
</span>
<span aria-label="Comment Line 107"><span class="c1"># Tail end of ' string.</span>
</span><span aria-label="Assign Line 108" id="Assign-L108" role="group"><span class="n">Single</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"[^'</span><span class="se">\\</span><span class="s2">]*(?:</span><span class="se">\\</span><span class="s2">.[^'</span><span class="se">\\</span><span class="s2">]*)*'"</span>
</span><span aria-label="Comment Line 109"><span class="c1"># Tail end of " string.</span>
</span><span aria-label="Assign Line 110" id="Assign-L110" role="group"><span class="n">Double</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[^"</span><span class="se">\\</span><span class="s1">]*(?:</span><span class="se">\\</span><span class="s1">.[^"</span><span class="se">\\</span><span class="s1">]*)*"'</span>
</span><span aria-label="Comment Line 111"><span class="c1"># Tail end of ''' string.</span>
</span><span aria-label="Assign Line 112" id="Assign-L112" role="group"><span class="n">Single3</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"[^'</span><span class="se">\\</span><span class="s2">]*(?:(?:</span><span class="se">\\</span><span class="s2">.|'(?!''))[^'</span><span class="se">\\</span><span class="s2">]*)*'''"</span>
</span><span aria-label="Comment Line 113"><span class="c1"># Tail end of """ string.</span>
</span><span aria-label="Assign Line 114" id="Assign-L114" role="group"><span class="n">Double3</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[^"</span><span class="se">\\</span><span class="s1">]*(?:(?:</span><span class="se">\\</span><span class="s1">.|"(?!""))[^"</span><span class="se">\\</span><span class="s1">]*)*"""'</span>
</span><span aria-label="Assign Line 115" id="Assign-L115" role="group"><span class="n">Triple</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">StringPrefix</span> <span class="o">+</span> <span class="s2">"'''"</span><span class="p">,</span> <span class="n">StringPrefix</span> <span class="o">+</span> <span class="s1">'"""'</span><span class="p">)</span>
</span><span aria-label="Comment Line 116"><span class="c1"># Single-line ' or " string.</span>
</span><span aria-label="Assign Line 117" id="Assign-L117" role="group"><span class="n">String</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">StringPrefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">"'[^\n'</span><span class="se">\\</span><span class="s2">]*(?:</span><span class="se">\\</span><span class="s2">.[^\n'</span><span class="se">\\</span><span class="s2">]*)*'"</span><span class="p">,</span>
               <span class="n">StringPrefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'"[^\n"</span><span class="se">\\</span><span class="s1">]*(?:</span><span class="se">\\</span><span class="s1">.[^\n"</span><span class="se">\\</span><span class="s1">]*)*"'</span><span class="p">)</span>
</span>
<span aria-label="Comment Line 120"><span class="c1"># Sorting in reverse order puts the long operators before their prefixes.</span>
<span class="c1"># Otherwise if = came before ==, == would get recognized as two instances</span>
<span class="c1"># of =.</span>
</span><span aria-label="Assign Line 123" id="Assign-L123" role="group"><span class="n">Special</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">EXACT_TOKEN_TYPES</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
</span><span aria-label="Assign Line 124" id="Assign-L124" role="group"><span class="n">Funny</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\r?\n'</span><span class="p">,</span> <span class="n">Special</span><span class="p">)</span>
</span>
<span aria-label="Assign Line 126" id="Assign-L126" role="group"><span class="n">PlainToken</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="n">Funny</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Name</span><span class="p">)</span>
</span><span aria-label="Assign Line 127" id="Assign-L127" role="group"><span class="n">Token</span> <span class="o">=</span> <span class="n">Ignore</span> <span class="o">+</span> <span class="n">PlainToken</span>
</span>
<span aria-label="Comment Line 129"><span class="c1"># First (or only) line of ' or " string.</span>
</span><span aria-label="Assign Line 130" id="Assign-L130" role="group"><span class="n">ContStr</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">StringPrefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">"'[^\n'</span><span class="se">\\</span><span class="s2">]*(?:</span><span class="se">\\</span><span class="s2">.[^\n'</span><span class="se">\\</span><span class="s2">]*)*"</span> <span class="o">+</span>
                <span class="n">group</span><span class="p">(</span><span class="s2">"'"</span><span class="p">,</span> <span class="sa">r</span><span class="s1">'</span><span class="se">\\</span><span class="s1">\r?\n'</span><span class="p">),</span>
                <span class="n">StringPrefix</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'"[^\n"</span><span class="se">\\</span><span class="s1">]*(?:</span><span class="se">\\</span><span class="s1">.[^\n"</span><span class="se">\\</span><span class="s1">]*)*'</span> <span class="o">+</span>
                <span class="n">group</span><span class="p">(</span><span class="s1">'"'</span><span class="p">,</span> <span class="sa">r</span><span class="s1">'</span><span class="se">\\</span><span class="s1">\r?\n'</span><span class="p">))</span>
</span><span aria-label="Assign Line 134" id="Assign-L134" role="group"><span class="n">PseudoExtras</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="sa">r</span><span class="s1">'</span><span class="se">\\</span><span class="s1">\r?\n|\Z'</span><span class="p">,</span> <span class="n">Comment</span><span class="p">,</span> <span class="n">Triple</span><span class="p">)</span>
</span><span aria-label="Assign Line 135" id="Assign-L135" role="group"><span class="n">PseudoToken</span> <span class="o">=</span> <span class="n">Whitespace</span> <span class="o">+</span> <span class="n">group</span><span class="p">(</span><span class="n">PseudoExtras</span><span class="p">,</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Funny</span><span class="p">,</span> <span class="n">ContStr</span><span class="p">,</span> <span class="n">Name</span><span class="p">)</span>
</span>
<span aria-label="Comment Line 137"><span class="c1"># For a given string prefix plus quotes, endpats maps it to a regex</span>
<span class="c1">#  to match the remainder of that string. _prefix can be empty, for</span>
<span class="c1">#  a normal single or triple quoted string (with no prefix).</span>
</span><span aria-label="Assign Line 140" id="Assign-L140" role="group"><span class="n">endpats</span> <span class="o">=</span> <span class="p">{}</span>
</span><span aria-label="For Line 141" id="For-L141" role="group"><span class="k">for</span> <span class="n">_prefix</span> <span class="ow">in</span> <span class="n">_all_string_prefixes</span><span class="p">():</span>
    <span class="n">endpats</span><span class="p">[</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">]</span> <span class="o">=</span> <span class="n">Single</span>
    <span class="n">endpats</span><span class="p">[</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">'"'</span><span class="p">]</span> <span class="o">=</span> <span class="n">Double</span>
    <span class="n">endpats</span><span class="p">[</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s2">"'''"</span><span class="p">]</span> <span class="o">=</span> <span class="n">Single3</span>
    <span class="n">endpats</span><span class="p">[</span><span class="n">_prefix</span> <span class="o">+</span> <span class="s1">'"""'</span><span class="p">]</span> <span class="o">=</span> <span class="n">Double3</span>
</span>
<span aria-label="Comment Line 147"><span class="c1"># A set of all of the single and triple quoted string prefixes,</span>
<span class="c1">#  including the opening quotes.</span>
</span><span aria-label="Assign Line 149" id="Assign-L149" role="group"><span class="n">single_quoted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span aria-label="Assign Line 150" id="Assign-L150" role="group"><span class="n">triple_quoted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span aria-label="For Line 151" id="For-L151" role="group"><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_all_string_prefixes</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="s1">'"'</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">):</span>
        <span class="n">single_quoted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="s1">'"""'</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="s2">"'''"</span><span class="p">):</span>
        <span class="n">triple_quoted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span>
<span aria-label="Assign Line 157" id="Assign-L157" role="group"><span class="n">tabsize</span> <span class="o">=</span> <span class="mi">8</span>
</span>
<span aria-label="TokenError" id="TokenError" role="region"><span class="k">class</span> <span class="nc"><a aria-level="2" href="#TokenError" role="heading">TokenError</a></span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
</span>
<span aria-label="StopTokenizing" id="StopTokenizing" role="region"><span class="k">class</span> <span class="nc"><a aria-level="2" href="#StopTokenizing" role="heading">StopTokenizing</a></span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
</span>

<span aria-label="Untokenizer" id="Untokenizer" role="region"><span class="k">class</span> <span class="nc"><a aria-level="2" href="#Untokenizer" role="heading">Untokenizer</a></span><span class="p">:</span>

    <span class="k">def</span> <span class="fm"><a aria-level="2" href="#Untokenizer" role="heading">__init__</a></span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="kc">None</span>

<span aria-label="Untokenizer.add_whitespace" id="Untokenizer.add_whitespace" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#Untokenizer.add_whitespace" role="heading">add_whitespace</a></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"start (</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">) precedes previous end (</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">)"</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span><span class="p">))</span>
        <span class="n">row_offset</span> <span class="o">=</span> <span class="n">row</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span>
        <span class="k">if</span> <span class="n">row_offset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"</span><span class="se">\\\n</span><span class="s2">"</span> <span class="o">*</span> <span class="n">row_offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">col_offset</span> <span class="o">=</span> <span class="n">col</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span>
        <span class="k">if</span> <span class="n">col_offset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">" "</span> <span class="o">*</span> <span class="n">col_offset</span><span class="p">)</span>
</span>
<span aria-label="Untokenizer.untokenize" id="Untokenizer.untokenize" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#Untokenizer.untokenize" role="heading">untokenize</a></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="n">indents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">startline</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compat</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">tok_type</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">if</span> <span class="n">tok_type</span> <span class="o">==</span> <span class="n">ENCODING</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">token</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">tok_type</span> <span class="o">==</span> <span class="n">ENDMARKER</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">tok_type</span> <span class="o">==</span> <span class="n">INDENT</span><span class="p">:</span>
                <span class="n">indents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">tok_type</span> <span class="o">==</span> <span class="n">DEDENT</span><span class="p">:</span>
                <span class="n">indents</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span> <span class="o">=</span> <span class="n">end</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">tok_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NEWLINE</span><span class="p">,</span> <span class="n">NL</span><span class="p">):</span>
                <span class="n">startline</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">startline</span> <span class="ow">and</span> <span class="n">indents</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="n">indents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span>
                <span class="n">startline</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_whitespace</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span> <span class="o">=</span> <span class="n">end</span>
            <span class="k">if</span> <span class="n">tok_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NEWLINE</span><span class="p">,</span> <span class="n">NL</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_row</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prev_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
</span>
<span aria-label="Untokenizer.compat" id="Untokenizer.compat" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#Untokenizer.compat" role="heading">compat</a></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="n">indents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">toks_append</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">append</span>
        <span class="n">startline</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NEWLINE</span><span class="p">,</span> <span class="n">NL</span><span class="p">)</span>
        <span class="n">prevstring</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">_itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="n">token</span><span class="p">],</span> <span class="n">iterable</span><span class="p">):</span>
            <span class="n">toknum</span><span class="p">,</span> <span class="n">tokval</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">toknum</span> <span class="o">==</span> <span class="n">ENCODING</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">tokval</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">toknum</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">NUMBER</span><span class="p">):</span>
                <span class="n">tokval</span> <span class="o">+=</span> <span class="s1">' '</span>

<span aria-label="Comment Line 237">            <span class="c1"># Insert a space between two consecutive strings</span>
</span>            <span class="k">if</span> <span class="n">toknum</span> <span class="o">==</span> <span class="n">STRING</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prevstring</span><span class="p">:</span>
                    <span class="n">tokval</span> <span class="o">=</span> <span class="s1">' '</span> <span class="o">+</span> <span class="n">tokval</span>
                <span class="n">prevstring</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prevstring</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">toknum</span> <span class="o">==</span> <span class="n">INDENT</span><span class="p">:</span>
                <span class="n">indents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokval</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">toknum</span> <span class="o">==</span> <span class="n">DEDENT</span><span class="p">:</span>
                <span class="n">indents</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">toknum</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NEWLINE</span><span class="p">,</span> <span class="n">NL</span><span class="p">):</span>
                <span class="n">startline</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">startline</span> <span class="ow">and</span> <span class="n">indents</span><span class="p">:</span>
                <span class="n">toks_append</span><span class="p">(</span><span class="n">indents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">startline</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">toks_append</span><span class="p">(</span><span class="n">tokval</span><span class="p">)</span>
</span></span>

<span aria-label="untokenize" id="untokenize" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#untokenize" role="heading">untokenize</a></span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Transform tokens back into Python source code.</span>
<span class="sd">    It returns a bytes object, encoded using the ENCODING</span>
<span class="sd">    token, which is the first token sequence output by tokenize.</span>

<span class="sd">    Each element returned by the iterable must be a token sequence</span>
<span class="sd">    with at least two elements, a token number and token value.  If</span>
<span class="sd">    only two tokens are passed, the resulting output is poor.</span>

<span class="sd">    Round-trip invariant for full input:</span>
<span class="sd">        Untokenized source will match input source exactly</span>

<span class="sd">    Round-trip invariant for limited input:</span>
<span class="sd">        # Output bytes will tokenize back to the input</span>
<span class="sd">        t1 = [tok[:2] for tok in tokenize(f.readline)]</span>
<span class="sd">        newcode = untokenize(t1)</span>
<span class="sd">        readline = BytesIO(newcode).readline</span>
<span class="sd">        t2 = [tok[:2] for tok in tokenize(readline)]</span>
<span class="sd">        assert t1 == t2</span>
<span class="sd">    """</span>
    <span class="n">ut</span> <span class="o">=</span> <span class="n">Untokenizer</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">untokenize</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</span>

<span aria-label="_get_normal_name" id="_get_normal_name" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#_get_normal_name" role="heading">_get_normal_name</a></span><span class="p">(</span><span class="n">orig_enc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Imitates get_normal_name in tokenizer.c."""</span>
<span aria-label="Comment Line 288">    <span class="c1"># Only care about the first 12 characters.</span>
</span>    <span class="n">enc</span> <span class="o">=</span> <span class="n">orig_enc</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"_"</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">enc</span> <span class="o">==</span> <span class="s2">"utf-8"</span> <span class="ow">or</span> <span class="n">enc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"utf-8-"</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"utf-8"</span>
    <span class="k">if</span> <span class="n">enc</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"latin-1"</span><span class="p">,</span> <span class="s2">"iso-8859-1"</span><span class="p">,</span> <span class="s2">"iso-latin-1"</span><span class="p">)</span> <span class="ow">or</span> \
       <span class="n">enc</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">"latin-1-"</span><span class="p">,</span> <span class="s2">"iso-8859-1-"</span><span class="p">,</span> <span class="s2">"iso-latin-1-"</span><span class="p">)):</span>
        <span class="k">return</span> <span class="s2">"iso-8859-1"</span>
    <span class="k">return</span> <span class="n">orig_enc</span>
</span>
<span aria-label="detect_encoding" id="detect_encoding" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#detect_encoding" role="heading">detect_encoding</a></span><span class="p">(</span><span class="n">readline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    The detect_encoding() function is used to detect the encoding that should</span>
<span class="sd">    be used to decode a Python source file.  It requires one argument, readline,</span>
<span class="sd">    in the same way as the tokenize() generator.</span>

<span class="sd">    It will call readline a maximum of twice, and return the encoding used</span>
<span class="sd">    (as a string) and a list of any lines (left as bytes) it has read in.</span>

<span class="sd">    It detects the encoding from the presence of a utf-8 bom or an encoding</span>
<span class="sd">    cookie as specified in pep-0263.  If both a bom and a cookie are present,</span>
<span class="sd">    but disagree, a SyntaxError will be raised.  If the encoding cookie is an</span>
<span class="sd">    invalid charset, raise a SyntaxError.  Note that if a utf-8 bom is found,</span>
<span class="sd">    'utf-8-sig' is returned.</span>

<span class="sd">    If no encoding is specified, then the default of 'utf-8' will be returned.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="vm">__self__</span><span class="o">.</span><span class="n">name</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bom_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default</span> <span class="o">=</span> <span class="s1">'utf-8'</span>
<span aria-label="detect_encoding.read_or_stop" id="detect_encoding.read_or_stop" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#detect_encoding.read_or_stop" role="heading">read_or_stop</a></span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">readline</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">b</span><span class="s1">''</span>
</span>
<span aria-label="detect_encoding.find_cookie" id="detect_encoding.find_cookie" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#detect_encoding.find_cookie" role="heading">find_cookie</a></span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
<span aria-label="Comment Line 329">            <span class="c1"># Decode as UTF-8. Either the line is an encoding declaration,</span>
            <span class="c1"># in which case it should be pure ASCII, or it must be UTF-8</span>
            <span class="c1"># per default encoding.</span>
</span>            <span class="n">line_string</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"invalid or missing encoding declaration"</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1"> for </span><span class="si">{!r}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">cookie_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">_get_normal_name</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">codec</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
<span aria-label="Comment Line 346">            <span class="c1"># This behaviour mimics the Python interpreter</span>
</span>            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">"unknown encoding: "</span> <span class="o">+</span> <span class="n">encoding</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">"unknown encoding for </span><span class="si">{!r}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                        <span class="n">encoding</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bom_found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="o">!=</span> <span class="s1">'utf-8'</span><span class="p">:</span>
<span aria-label="Comment Line 356">                <span class="c1"># This behaviour mimics the Python interpreter</span>
</span>                <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">'encoding problem: utf-8'</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">'encoding problem for </span><span class="si">{!r}</span><span class="s1">: utf-8'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">encoding</span> <span class="o">+=</span> <span class="s1">'-sig'</span>
        <span class="k">return</span> <span class="n">encoding</span>
</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">read_or_stop</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">BOM_UTF8</span><span class="p">):</span>
        <span class="n">bom_found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">default</span> <span class="o">=</span> <span class="s1">'utf-8-sig'</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">encoding</span> <span class="o">=</span> <span class="n">find_cookie</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">encoding</span><span class="p">,</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">blank_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">first</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span><span class="p">,</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span>

    <span class="n">second</span> <span class="o">=</span> <span class="n">read_or_stop</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">second</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span><span class="p">,</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span>

    <span class="n">encoding</span> <span class="o">=</span> <span class="n">find_cookie</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">encoding</span><span class="p">,</span> <span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">default</span><span class="p">,</span> <span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">]</span>
</span>

<span aria-label="open" id="open" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#open" role="heading">open</a></span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Open a file in read only mode using the encoding detected by</span>
<span class="sd">    detect_encoding().</span>
<span class="sd">    """</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">_builtin_open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">encoding</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">detect_encoding</span><span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">readline</span><span class="p">)</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">line_buffering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">'r'</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">raise</span>
</span>

<span aria-label="tokenize" id="tokenize" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#tokenize" role="heading">tokenize</a></span><span class="p">(</span><span class="n">readline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    The tokenize() generator requires one argument, readline, which</span>
<span class="sd">    must be a callable object which provides the same interface as the</span>
<span class="sd">    readline() method of built-in file objects.  Each call to the function</span>
<span class="sd">    should return one line of input as bytes.  Alternatively, readline</span>
<span class="sd">    can be a callable function terminating with StopIteration:</span>
<span class="sd">        readline = open(myfile, 'rb').__next__  # Example of alternate readline</span>

<span class="sd">    The generator produces 5-tuples with these members: the token type; the</span>
<span class="sd">    token string; a 2-tuple (srow, scol) of ints specifying the row and</span>
<span class="sd">    column where the token begins in the source; a 2-tuple (erow, ecol) of</span>
<span class="sd">    ints specifying the row and column where the token ends in the source;</span>
<span class="sd">    and the line on which the token was found.  The line passed is the</span>
<span class="sd">    physical line.</span>

<span class="sd">    The first token sequence will always be an ENCODING token</span>
<span class="sd">    which tells you which encoding was used to decode the bytes stream.</span>
<span class="sd">    """</span>
    <span class="n">encoding</span><span class="p">,</span> <span class="n">consumed</span> <span class="o">=</span> <span class="n">detect_encoding</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="n">_itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="sa">b</span><span class="s2">""</span><span class="p">)</span>
    <span class="n">rl_gen</span> <span class="o">=</span> <span class="n">_itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">consumed</span><span class="p">,</span> <span class="nb">iter</span><span class="p">(</span><span class="n">readline</span><span class="p">,</span> <span class="sa">b</span><span class="s2">""</span><span class="p">),</span> <span class="n">empty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_tokenize</span><span class="p">(</span><span class="n">rl_gen</span><span class="o">.</span><span class="fm">__next__</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
</span>

<span aria-label="_tokenize" id="_tokenize" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#_tokenize" role="heading">_tokenize</a></span><span class="p">(</span><span class="n">readline</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
    <span class="n">lnum</span> <span class="o">=</span> <span class="n">parenlev</span> <span class="o">=</span> <span class="n">continued</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">numchars</span> <span class="o">=</span> <span class="s1">'0123456789'</span>
    <span class="n">contstr</span><span class="p">,</span> <span class="n">needcont</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">contline</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">indents</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s2">"utf-8-sig"</span><span class="p">:</span>
<span aria-label="Comment Line 440">            <span class="c1"># BOM will already have been stripped.</span>
</span>            <span class="n">encoding</span> <span class="o">=</span> <span class="s2">"utf-8"</span>
        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">ENCODING</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">''</span><span class="p">)</span>
    <span class="n">last_line</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
    <span class="n">line</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>                                <span class="c1"># loop over lines in stream</span>
        <span class="k">try</span><span class="p">:</span>
<span aria-label="Comment Line 447">            <span class="c1"># We capture the value of the line variable here because</span>
            <span class="c1"># readline uses the empty string '' to signal end of input,</span>
            <span class="c1"># hence `line` itself will always be overwritten at the end</span>
            <span class="c1"># of this loop.</span>
</span>            <span class="n">last_line</span> <span class="o">=</span> <span class="n">line</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">readline</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>

        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="n">lnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">pos</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">contstr</span><span class="p">:</span>                            <span class="c1"># continued string</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TokenError</span><span class="p">(</span><span class="s2">"EOF in multi-line string"</span><span class="p">,</span> <span class="n">strstart</span><span class="p">)</span>
            <span class="n">endmatch</span> <span class="o">=</span> <span class="n">endprog</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">endmatch</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">end</span> <span class="o">=</span> <span class="n">endmatch</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">STRING</span><span class="p">,</span> <span class="n">contstr</span> <span class="o">+</span> <span class="n">line</span><span class="p">[:</span><span class="n">end</span><span class="p">],</span>
                       <span class="n">strstart</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span> <span class="n">contline</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">contstr</span><span class="p">,</span> <span class="n">needcont</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">contline</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">needcont</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">'</span><span class="se">\\\n</span><span class="s1">'</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">'</span><span class="se">\\\r\n</span><span class="s1">'</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">ERRORTOKEN</span><span class="p">,</span> <span class="n">contstr</span> <span class="o">+</span> <span class="n">line</span><span class="p">,</span>
                           <span class="n">strstart</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)),</span> <span class="n">contline</span><span class="p">)</span>
                <span class="n">contstr</span> <span class="o">=</span> <span class="s1">''</span>
                <span class="n">contline</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contstr</span> <span class="o">=</span> <span class="n">contstr</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">contline</span> <span class="o">=</span> <span class="n">contline</span> <span class="o">+</span> <span class="n">line</span>
                <span class="k">continue</span>

        <span class="k">elif</span> <span class="n">parenlev</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">continued</span><span class="p">:</span>  <span class="c1"># new statement</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">:</span>                   <span class="c1"># measure leading whitespace</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">' '</span><span class="p">:</span>
                    <span class="n">column</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">:</span>
                    <span class="n">column</span> <span class="o">=</span> <span class="p">(</span><span class="n">column</span><span class="o">//</span><span class="n">tabsize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">tabsize</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'</span><span class="se">\f</span><span class="s1">'</span><span class="p">:</span>
                    <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">'#</span><span class="se">\r\n</span><span class="s1">'</span><span class="p">:</span>           <span class="c1"># skip comments or blank lines</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'#'</span><span class="p">:</span>
                    <span class="n">comment_token</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">COMMENT</span><span class="p">,</span> <span class="n">comment_token</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment_token</span><span class="p">)),</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment_token</span><span class="p">)</span>

                <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">NL</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:],</span>
                           <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)),</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">column</span> <span class="o">&gt;</span> <span class="n">indents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>           <span class="c1"># count indents or dedents</span>
                <span class="n">indents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">line</span><span class="p">[:</span><span class="n">pos</span><span class="p">],</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">column</span> <span class="o">&lt;</span> <span class="n">indents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indents</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndentationError</span><span class="p">(</span>
                        <span class="s2">"unindent does not match any outer indentation level"</span><span class="p">,</span>
                        <span class="p">(</span><span class="s2">"&lt;tokenize&gt;"</span><span class="p">,</span> <span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="n">indents</span> <span class="o">=</span> <span class="n">indents</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">DEDENT</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>                                  <span class="c1"># continued statement</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TokenError</span><span class="p">(</span><span class="s2">"EOF in multi-line statement"</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">continued</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">:</span>
            <span class="n">pseudomatch</span> <span class="o">=</span> <span class="n">_compile</span><span class="p">(</span><span class="n">PseudoToken</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pseudomatch</span><span class="p">:</span>                                <span class="c1"># scan for tokens</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">pseudomatch</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span> <span class="n">end</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">token</span><span class="p">,</span> <span class="n">initial</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">initial</span> <span class="ow">in</span> <span class="n">numchars</span> <span class="ow">or</span>                 <span class="c1"># ordinary number</span>
                    <span class="p">(</span><span class="n">initial</span> <span class="o">==</span> <span class="s1">'.'</span> <span class="ow">and</span> <span class="n">token</span> <span class="o">!=</span> <span class="s1">'.'</span> <span class="ow">and</span> <span class="n">token</span> <span class="o">!=</span> <span class="s1">'...'</span><span class="p">)):</span>
                    <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">NUMBER</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">initial</span> <span class="ow">in</span> <span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parenlev</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">NL</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">NEWLINE</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">initial</span> <span class="o">==</span> <span class="s1">'#'</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">COMMENT</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">triple_quoted</span><span class="p">:</span>
                    <span class="n">endprog</span> <span class="o">=</span> <span class="n">_compile</span><span class="p">(</span><span class="n">endpats</span><span class="p">[</span><span class="n">token</span><span class="p">])</span>
                    <span class="n">endmatch</span> <span class="o">=</span> <span class="n">endprog</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">endmatch</span><span class="p">:</span>                           <span class="c1"># all on one line</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">endmatch</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">token</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span>
                        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">STRING</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">strstart</span> <span class="o">=</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>           <span class="c1"># multiple lines</span>
                        <span class="n">contstr</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span>
                        <span class="n">contline</span> <span class="o">=</span> <span class="n">line</span>
                        <span class="k">break</span>

<span aria-label="Comment Line 561">                <span class="c1"># Check up to the first 3 chars of the token to see if</span>
                <span class="c1">#  they're in the single_quoted set. If so, they start</span>
                <span class="c1">#  a string.</span>
                <span class="c1"># We're using the first 3, because we're looking for</span>
                <span class="c1">#  "rb'" (for example) at the start of the token. If</span>
                <span class="c1">#  we switch to longer prefixes, this needs to be</span>
                <span class="c1">#  adjusted.</span>
                <span class="c1"># Note that initial == token[:1].</span>
                <span class="c1"># Also note that single quote checking must come after</span>
                <span class="c1">#  triple quote checking (above).</span>
</span>                <span class="k">elif</span> <span class="p">(</span><span class="n">initial</span> <span class="ow">in</span> <span class="n">single_quoted</span> <span class="ow">or</span>
                      <span class="n">token</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">single_quoted</span> <span class="ow">or</span>
                      <span class="n">token</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">single_quoted</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">:</span>                  <span class="c1"># continued string</span>
                        <span class="n">strstart</span> <span class="o">=</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
<span aria-label="Comment Line 576">                        <span class="c1"># Again, using the first 3 chars of the</span>
                        <span class="c1">#  token. This is looking for the matching end</span>
                        <span class="c1">#  regex for the correct type of quote</span>
                        <span class="c1">#  character. So it's really looking for</span>
                        <span class="c1">#  endpats["'"] or endpats['"'], by trying to</span>
                        <span class="c1">#  skip string prefix characters, if any.</span>
</span>                        <span class="n">endprog</span> <span class="o">=</span> <span class="n">_compile</span><span class="p">(</span><span class="n">endpats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span> <span class="ow">or</span>
                                           <span class="n">endpats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span>
                                           <span class="n">endpats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">contstr</span><span class="p">,</span> <span class="n">needcont</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">:],</span> <span class="mi">1</span>
                        <span class="n">contline</span> <span class="o">=</span> <span class="n">line</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>                                  <span class="c1"># ordinary string</span>
                        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">STRING</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">initial</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>               <span class="c1"># ordinary name</span>
                    <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">initial</span> <span class="o">==</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">:</span>                      <span class="c1"># continued stmt</span>
                    <span class="n">continued</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">initial</span> <span class="ow">in</span> <span class="s1">'([{'</span><span class="p">:</span>
                        <span class="n">parenlev</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">initial</span> <span class="ow">in</span> <span class="s1">')]}'</span><span class="p">:</span>
                        <span class="n">parenlev</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">OP</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">spos</span><span class="p">,</span> <span class="n">epos</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">ERRORTOKEN</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                           <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

<span aria-label="Comment Line 606">    <span class="c1"># Add an implicit NEWLINE if the input doesn't end in one</span>
</span>    <span class="k">if</span> <span class="n">last_line</span> <span class="ow">and</span> <span class="n">last_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">'</span><span class="se">\r\n</span><span class="s1">'</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">last_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"#"</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">NEWLINE</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_line</span><span class="p">)),</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_line</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">''</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">indent</span> <span class="ow">in</span> <span class="n">indents</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>                 <span class="c1"># pop remaining indent levels</span>
        <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">DEDENT</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">''</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">TokenInfo</span><span class="p">(</span><span class="n">ENDMARKER</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">lnum</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">''</span><span class="p">)</span>
</span>

<span aria-label="generate_tokens" id="generate_tokens" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#generate_tokens" role="heading">generate_tokens</a></span><span class="p">(</span><span class="n">readline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Tokenize a source reading Python code as unicode strings.</span>

<span class="sd">    This has the same API as tokenize(), except that it expects the *readline*</span>
<span class="sd">    callable to return str objects instead of bytes.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">_tokenize</span><span class="p">(</span><span class="n">readline</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span>
<span aria-label="main" id="main" role="region"><span class="k">def</span> <span class="nf"><a aria-level="2" href="#main" role="heading">main</a></span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">argparse</span>

<span aria-label="Comment Line 625">    <span class="c1"># Helper error handling routines</span>
</span><span aria-label="main.perror" id="main.perror" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#main.perror" role="heading">perror</a></span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</span>
<span aria-label="main.error" id="main.error" role="region">    <span class="k">def</span> <span class="nf"><a aria-level="3" href="#main.error" role="heading">error</a></span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">location</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span> <span class="o">+</span> <span class="n">location</span> <span class="o">+</span> <span class="p">(</span><span class="n">message</span><span class="p">,)</span>
            <span class="n">perror</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: error: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">perror</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: error: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">perror</span><span class="p">(</span><span class="s2">"error: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span>
<span aria-label="Comment Line 640">    <span class="c1"># Parse the arguments and options</span>
</span>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">'python -m tokenize'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="s1">'filename'</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">'?'</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s1">'filename.py'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'the file to tokenize; defaults to stdin'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-e'</span><span class="p">,</span> <span class="s1">'--exact'</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">'exact'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">'display token names using the exact type'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
<span aria-label="Comment Line 650">        <span class="c1"># Tokenize the input</span>
</span>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">filename</span>
            <span class="k">with</span> <span class="n">_builtin_open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tokenize</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">"&lt;stdin&gt;"</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">_tokenize</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span aria-label="Comment Line 659">        <span class="c1"># Output the tokenization</span>
</span>        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">token_type</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">exact</span><span class="p">:</span>
                <span class="n">token_type</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">exact_type</span>
            <span class="n">token_range</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">:"</span> <span class="o">%</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">token</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%-20s%-15s%-15r</span><span class="s2">"</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">token_range</span><span class="p">,</span> <span class="n">tok_name</span><span class="p">[</span><span class="n">token_type</span><span class="p">],</span> <span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">IndentationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">TokenError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">column</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"interrupted</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">perror</span><span class="p">(</span><span class="s2">"unexpected error: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">raise</span>
</span>
<span aria-label="If Line 683" id="If-L683" role="group"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</span></pre>
         </div>
        </details>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 21 cell-21-cell_type" class="cell markdown" data-index="21" data-loc="4" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 21" class="nb-anchor visually-hidden" href="#21" id="21">
        21
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-21-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-21-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-21-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-21-exec-label" class="nb-toolbar" hidden id="cell-21" name="cell-21">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-21-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-21-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-21-in-label cell-21-exec-label nb-source-label" class="nb-source" form="cell-21" id="cell-21-source" name="source" readonly rows="4">## a page/document of code

all of this can be combined into a complete page of that treats code as an accessible document.
we can event include a heading for navigation.</textarea>
       <div aria-labelledby="cell-21-in-label cell-21-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">## a page/document of code</span>

all of this can be combined into a complete page of that treats code as an accessible document.
we can event include a heading for navigation.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-21-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-21" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-21-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h2><a href="#a-page-document-of-code">a page/document of code</a></h2>\n<p>all of this can be combined into a complete page of that treats code as an accessible document.\nwe can event include a heading for navigation.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-21-loc" role="none">
       4
      </td>
      <td class="nb-outputs" role="none">
       <h2>
        <a href="#a-page-document-of-code">
         a page/document of code
        </a>
       </h2>
       <p>
        all of this can be combined into a complete page of that treats code as an accessible document.
we can event include a heading for navigation.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 22 cell-22-cell_type" class="cell code" data-index="22" data-loc="8" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-22-loc nb-loc-label
    cell-22-outputs-len" aria-labelledby="nb-cell-label 22" class="nb-anchor visually-hidden" href="#22" id="22">
        22
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-22-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-22-exec-label">
         11
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-22-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-22-exec-label" class="nb-toolbar" hidden id="cell-22" name="cell-22">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-22-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-22-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-22-in-label cell-22-exec-label nb-source-label" class="nb-source" form="cell-22" id="cell-22-source" name="source" readonly rows="8">    def get_toc(body):
        import mistune, textwrap
        soup = __import__("bs4").BeautifulSoup(body, features="html.parser")
        toc = """"""
        for x in soup.select("[role=heading][aria-level]"):
            toc += "  " * int(x.attrs.get("aria-level"))
            toc += F"* [`{x.string}`](#{x.string})\n"
        return mistune.markdown(textwrap.dedent(toc))</textarea>
       <div aria-labelledby="cell-22-in-label cell-22-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="k">def</span> <span class="nf">get_toc</span><span class="p">(</span><span class="n">body</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">mistune</span><span class="o">,</span> <span class="nn">textwrap</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s2">"bs4"</span><span class="p">)</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s2">"html.parser"</span><span class="p">)</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="s2">""""""</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"[role=heading][aria-level]"</span><span class="p">):</span>
            <span class="n">toc</span> <span class="o">+=</span> <span class="s2">"  "</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"aria-level"</span><span class="p">))</span>
            <span class="n">toc</span> <span class="o">+=</span> <span class="sa">F</span><span class="s2">"* [`</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">string</span><span class="si">}</span><span class="s2">`](#</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">string</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">"</span>
        <span class="k">return</span> <span class="n">mistune</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">toc</span><span class="p">))</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-22-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-22" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-22-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-22-loc" role="none">
       8
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-22-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-22-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          11
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 23 cell-23-cell_type" class="cell markdown" data-index="23" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 23" class="nb-anchor visually-hidden" href="#23" id="23">
        23
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-23-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-23-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-23-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-23-exec-label" class="nb-toolbar" hidden id="cell-23" name="cell-23">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-23-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-23-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-23-in-label cell-23-exec-label nb-source-label" class="nb-source" form="cell-23" id="cell-23-source" name="source" readonly rows="1">capture the css styles.</textarea>
       <div aria-labelledby="cell-23-in-label cell-23-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>capture the css styles.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-23-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-23" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-23-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<p>capture the css styles.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-23-loc" role="none">
       1
      </td>
      <td class="nb-outputs" role="none">
       <p>
        capture the css styles.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 24 cell-24-cell_type" class="cell code" data-index="24" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-24-loc nb-loc-label
    cell-24-outputs-len" aria-labelledby="nb-cell-label 24" class="nb-anchor visually-hidden" href="#24" id="24">
        24
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-24-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-24-exec-label">
         12
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-24-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-24-exec-label" class="nb-toolbar" hidden id="cell-24" name="cell-24">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-24-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-24-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-24-in-label cell-24-exec-label nb-source-label" class="nb-source" form="cell-24" id="cell-24-source" name="source" readonly rows="1">    style = formatter; HTML(F"&lt;style&gt;{style}&lt;/style&gt;")</textarea>
       <div aria-labelledby="cell-24-in-label cell-24-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="n">style</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">;</span> <span class="n">HTML</span><span class="p">(</span><span class="sa">F</span><span class="s2">"&lt;style&gt;</span><span class="si">{</span><span class="n">style</span><span class="si">}</span><span class="s2">&lt;/style&gt;"</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-24-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-24" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-24-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-24-loc" role="none">
       1
      </td>
      <td class="nb-outputs" role="none">
       <span class="nb-outputs visually-hidden" id="cell-24-outputs-len">
        1 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="1">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-24-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          12
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
        <style>
         <__main__.Html object at 0x7f1ef3e5bfa0>
        </style>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 25 cell-25-cell_type" class="cell code" data-index="25" data-loc="4" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-25-loc nb-loc-label
    cell-25-outputs-len" aria-labelledby="nb-cell-label 25" class="nb-anchor visually-hidden" href="#25" id="25">
        25
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-25-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-25-exec-label">
         13
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-25-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-25-exec-label" class="nb-toolbar" hidden id="cell-25" name="cell-25">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-25-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-25-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-25-in-label cell-25-exec-label nb-source-label" class="nb-source" form="cell-25" id="cell-25-source" name="source" readonly rows="4">    all = F"""&lt;head&gt;&lt;meta content="dark light" name="color-scheme"/&gt;
    &lt;style&gt;{Html(style="github-dark-high-contrast").get_style_defs()}&lt;/style&gt;
    &lt;/head&gt;&lt;body&gt;&lt;main&gt;&lt;header&gt;
    &lt;details&gt;&lt;summary&gt;Table of contents&lt;/summary&gt;&lt;nav&gt;{get_toc(page)}&lt;/nav&gt;&lt;/details&gt;&lt;/header&gt;{page}&lt;/main&gt;"""&lt;/body&gt;</textarea>
       <div aria-labelledby="cell-25-in-label cell-25-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="nb">all</span> <span class="o">=</span> <span class="sa">F</span><span class="s2">"""&lt;head&gt;&lt;meta name="color-scheme" content="dark light"&gt;</span>
<span class="s2">    &lt;style&gt;</span><span class="si">{</span><span class="n">Html</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"github-dark-high-contrast"</span><span class="p">)</span><span class="o">.</span><span class="n">get_style_defs</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/style&gt;</span>
<span class="s2">    &lt;/head&gt;&lt;body&gt;&lt;main&gt;&lt;header&gt;</span>
<span class="s2">    &lt;details&gt;&lt;summary&gt;Table of contents&lt;/summary&gt;&lt;nav&gt;</span><span class="si">{</span><span class="n">get_toc</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/nav&gt;&lt;/details&gt;&lt;/header&gt;</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&lt;/main&gt;"""</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-25-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-25" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-25-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-25-loc" role="none">
       4
      </td>
      <td class="nb-outputs" hidden role="none">
       <span class="nb-outputs visually-hidden" id="cell-25-outputs-len">
        0 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="0">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-25-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          13
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 26 cell-26-cell_type" class="cell code" data-index="26" data-loc="1" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-26-loc nb-loc-label
    cell-26-outputs-len" aria-labelledby="nb-cell-label 26" class="nb-anchor visually-hidden" href="#26" id="26">
        26
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-26-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-26-exec-label">
         14
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-26-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-26-exec-label" class="nb-toolbar" hidden id="cell-26" name="cell-26">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-26-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-26-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-26-in-label cell-26-exec-label nb-source-label" class="nb-source" form="cell-26" id="cell-26-source" name="source" readonly rows="1">    HTML(F'&lt;iframe height="600" srcdoc="{html.escape(all)}" width="100%"&gt;&lt;/iframe&gt;')</textarea>
       <div aria-labelledby="cell-26-in-label cell-26-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code>    <span class="n">HTML</span><span class="p">(</span><span class="sa">F</span><span class="s1">'&lt;iframe srcdoc="</span><span class="si">{</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span><span class="si">}</span><span class="s1">" height=600 width="100%"/&gt;'</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-26-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-26" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-26-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'scrolled': True}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-26-loc" role="none">
       1
      </td>
      <td class="nb-outputs" role="none">
       <span class="nb-outputs visually-hidden" id="cell-26-outputs-len">
        1 outputs.
       </span>
       <fieldset class="nb-outputs nb-scrolled" data-outputs="1">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-26-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          14
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
        <iframe height="600" srcdoc="&lt;head&gt;&lt;meta name=&quot;color-scheme&quot; content=&quot;dark light&quot;&gt;
&lt;style&gt;pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #58a6ff70 }
.c { color: #d9dee3 } /* Comment */
.err { color: #ff9492 } /* Error */
.k { color: #ff9492 } /* Keyword */
.l { color: #ffb757 } /* Literal */
.n { color: #dbb7ff } /* Name */
.o { color: #72f088 } /* Operator */
.p { color: #C9D1D9 } /* Punctuation */
.ch { color: #d9dee3 } /* Comment.Hashbang */
.cm { color: #d9dee3 } /* Comment.Multiline */
.cp { color: #d9dee3 } /* Comment.Preproc */
.cpf { color: #d9dee3 } /* Comment.PreprocFile */
.c1 { color: #d9dee3 } /* Comment.Single */
.cs { color: #d9dee3 } /* Comment.Special */
.gd { color: #91cbff } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #ff9492 } /* Generic.Error */
.gh { color: #91cbff } /* Generic.Heading */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #91cbff } /* Generic.Subheading */
.kc { color: #91cbff } /* Keyword.Constant */
.kd { color: #ff9492 } /* Keyword.Declaration */
.kn { color: #ff9492 } /* Keyword.Namespace */
.kp { color: #ff9492 } /* Keyword.Pseudo */
.kr { color: #ff9492 } /* Keyword.Reserved */
.kt { color: #ff9492 } /* Keyword.Type */
.ld { color: #ffb757 } /* Literal.Date */
.m { color: #ffb757 } /* Literal.Number */
.s { color: #91cbff } /* Literal.String */
.na { color: #ffb757 } /* Name.Attribute */
.nb { color: #ffb757 } /* Name.Builtin */
.nc { color: #91cbff } /* Name.Class */
.no { color: #91cbff } /* Name.Constant */
.nd { color: #ffb757 } /* Name.Decorator */
.ni { color: #72f088 } /* Name.Entity */
.ne { color: #dbb7ff } /* Name.Exception */
.nf { color: #91cbff } /* Name.Function */
.nl { color: #ffb757 } /* Name.Label */
.nn { color: #C9D1D9 } /* Name.Namespace */
.nx { color: #dbb7ff } /* Name.Other */
.py { color: #91cbff } /* Name.Property */
.nt { color: #72f088 } /* Name.Tag */
.nv { color: #ffb757 } /* Name.Variable */
.ow { color: #dbb7ff } /* Operator.Word */
.pm { color: #C9D1D9 } /* Punctuation.Marker */
.w { color: #C9D1D9 } /* Text.Whitespace */
.mb { color: #ffb757 } /* Literal.Number.Bin */
.mf { color: #ffb757 } /* Literal.Number.Float */
.mh { color: #ffb757 } /* Literal.Number.Hex */
.mi { color: #ffb757 } /* Literal.Number.Integer */
.mo { color: #ffb757 } /* Literal.Number.Oct */
.sa { color: #91cbff } /* Literal.String.Affix */
.sb { color: #91cbff } /* Literal.String.Backtick */
.sc { color: #91cbff } /* Literal.String.Char */
.dl { color: #91cbff } /* Literal.String.Delimiter */
.sd { color: #91cbff } /* Literal.String.Doc */
.s2 { color: #91cbff } /* Literal.String.Double */
.se { color: #91cbff } /* Literal.String.Escape */
.sh { color: #91cbff } /* Literal.String.Heredoc */
.si { color: #91cbff } /* Literal.String.Interpol */
.sx { color: #91cbff } /* Literal.String.Other */
.sr { color: #91cbff } /* Literal.String.Regex */
.s1 { color: #91cbff } /* Literal.String.Single */
.ss { color: #91cbff } /* Literal.String.Symbol */
.bp { color: #ffb757 } /* Name.Builtin.Pseudo */
.fm { color: #91cbff } /* Name.Function.Magic */
.vc { color: #ffb757 } /* Name.Variable.Class */
.vg { color: #ffb757 } /* Name.Variable.Global */
.vi { color: #ffb757 } /* Name.Variable.Instance */
.vm { color: #ffb757 } /* Name.Variable.Magic */
.il { color: #ffb757 } /* Literal.Number.Integer.Long */&lt;/style&gt;
&lt;/head&gt;&lt;body&gt;&lt;main&gt;&lt;header&gt;
&lt;details&gt;&lt;summary&gt;Table of contents&lt;/summary&gt;&lt;nav&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#TokenInfo&quot;&gt;&lt;code&gt;TokenInfo&lt;/code&gt;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#__repr__&quot;&gt;&lt;code&gt;__repr__&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#exact_type&quot;&gt;&lt;code&gt;exact_type&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#group&quot;&gt;&lt;code&gt;group&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#any&quot;&gt;&lt;code&gt;any&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#maybe&quot;&gt;&lt;code&gt;maybe&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#_all_string_prefixes&quot;&gt;&lt;code&gt;_all_string_prefixes&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#_compile&quot;&gt;&lt;code&gt;_compile&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#TokenError&quot;&gt;&lt;code&gt;TokenError&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#StopTokenizing&quot;&gt;&lt;code&gt;StopTokenizing&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#Untokenizer&quot;&gt;&lt;code&gt;Untokenizer&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__init__&quot;&gt;&lt;code&gt;__init__&lt;/code&gt;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#add_whitespace&quot;&gt;&lt;code&gt;add_whitespace&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#untokenize&quot;&gt;&lt;code&gt;untokenize&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#compat&quot;&gt;&lt;code&gt;compat&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#untokenize&quot;&gt;&lt;code&gt;untokenize&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#_get_normal_name&quot;&gt;&lt;code&gt;_get_normal_name&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#detect_encoding&quot;&gt;&lt;code&gt;detect_encoding&lt;/code&gt;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#read_or_stop&quot;&gt;&lt;code&gt;read_or_stop&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#find_cookie&quot;&gt;&lt;code&gt;find_cookie&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#open&quot;&gt;&lt;code&gt;open&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#tokenize&quot;&gt;&lt;code&gt;tokenize&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#_tokenize&quot;&gt;&lt;code&gt;_tokenize&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#generate_tokens&quot;&gt;&lt;code&gt;generate_tokens&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#main&quot;&gt;&lt;code&gt;main&lt;/code&gt;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#perror&quot;&gt;&lt;code&gt;perror&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#error&quot;&gt;&lt;code&gt;error&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/nav&gt;&lt;/details&gt;&lt;/header&gt;&lt;div class=&quot;highlight&quot;&gt;
 &lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span aria-label=&quot;Expr Line 1&quot; id=&quot;Expr-L1&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;Tokenization help for Python programs.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;tokenize(readline) is a generator that breaks a stream of bytes into&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;Python tokens.  It decodes the bytes according to PEP-0263 for&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;determining source file encoding.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;It accepts a readline-like method which is called repeatedly to get the&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;next line of input (or b&quot;&quot; for EOF).  It generates 5-tuples with these&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;members:&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    the token type (see token.py)&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    the token (a string)&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    the starting (row, column) indices of the token (a 2-tuple of ints)&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    the ending (row, column) indices of the token (a 2-tuple of ints)&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    the original line (string)&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;It is designed to match the working of the Python tokenizer exactly, except&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;that it produces COMMENT tokens for comments and gives type OP for all&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;operators.  Additionally, all token lists start with an ENCODING token&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;which tells you which encoding was used to decode the bytes stream.&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;

&lt;span aria-label=&quot;Assign Line 23&quot; id=&quot;Assign-L23&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;__author__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Ka-Ping Yee &amp;lt;ping@lfw.org&amp;gt;'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 24&quot; id=&quot;Assign-L24&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;__credits__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'GvR, ESR, Tim Peters, Thomas Wouters, Fred Drake, '&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'Skip Montanaro, Raymond Hettinger, Trent Nelson, '&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'Michael Foord'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;ImportFrom Line 27&quot; id=&quot;ImportFrom-L27&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;builtins&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_builtin_open&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;ImportFrom Line 28&quot; id=&quot;ImportFrom-L28&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;codecs&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lookup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BOM_UTF8&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Import Line 29&quot; id=&quot;Import-L29&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;collections&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Import Line 30&quot; id=&quot;Import-L30&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;functools&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;ImportFrom Line 31&quot; id=&quot;ImportFrom-L31&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;io&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TextIOWrapper&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Import Line 32&quot; id=&quot;Import-L32&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;itertools&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;_itertools&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Import Line 33&quot; id=&quot;Import-L33&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;re&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Import Line 34&quot; id=&quot;Import-L34&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;ImportFrom Line 35&quot; id=&quot;ImportFrom-L35&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;ImportFrom Line 36&quot; id=&quot;ImportFrom-L36&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXACT_TOKEN_TYPES&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Assign Line 38&quot; id=&quot;Assign-L38&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;cookie_re&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'^[ \t\f]*#.*?coding[:=][ \t]*([-\w.]+)'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ASCII&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 39&quot; id=&quot;Assign-L39&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;blank_re&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;br&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'^[ \t\f]*(?:[#\r\n]|$)'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ASCII&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Import Line 41&quot; id=&quot;Import-L41&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;token&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 42&quot; id=&quot;Assign-L42&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;__all__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__all__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tokenize&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;generate_tokens&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;detect_encoding&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                           &lt;span class=&quot;s2&quot;&gt;&quot;untokenize&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;TokenInfo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Delete Line 44&quot; id=&quot;Delete-L44&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;k&quot;&gt;del&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;TokenInfo&quot; id=&quot;TokenInfo&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#TokenInfo&quot; role=&quot;heading&quot;&gt;TokenInfo&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;collections&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;namedtuple&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'TokenInfo'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'type string start end line'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)):&lt;/span&gt;
&lt;span aria-label=&quot;TokenInfo.__repr__&quot; id=&quot;TokenInfo.__repr__&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;fm&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#TokenInfo.__repr__&quot; role=&quot;heading&quot;&gt;__repr__&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;annotated_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; (&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;)'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'TokenInfo(type=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;, string=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;, start=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;, end=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;, line=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;)'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;annotated_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@property&lt;/span&gt;
&lt;span aria-label=&quot;TokenInfo.exact_type&quot; id=&quot;TokenInfo.exact_type&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#TokenInfo.exact_type&quot; role=&quot;heading&quot;&gt;exact_type&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OP&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXACT_TOKEN_TYPES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXACT_TOKEN_TYPES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;
&lt;span aria-label=&quot;group&quot; id=&quot;group&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#group&quot; role=&quot;heading&quot;&gt;group&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'('&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'|'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;')'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;any&quot; id=&quot;any&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#any&quot; role=&quot;heading&quot;&gt;any&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'*'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;maybe&quot; id=&quot;maybe&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#maybe&quot; role=&quot;heading&quot;&gt;maybe&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choices&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 63&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Note: we use unicode matching for names (&quot;\w&quot;) but ascii matching for&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# number literals.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 65&quot; id=&quot;Assign-L65&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Whitespace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[ \f\t]*'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 66&quot; id=&quot;Assign-L66&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'#[^\r\n]*'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 67&quot; id=&quot;Assign-L67&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Ignore&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Whitespace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;\r?\n'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Whitespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maybe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 68&quot; id=&quot;Assign-L68&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'\w+'&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Assign Line 70&quot; id=&quot;Assign-L70&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Hexnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'0[xX](?:_?[0-9a-fA-F])+'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 71&quot; id=&quot;Assign-L71&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Binnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'0[bB](?:_?[01])+'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 72&quot; id=&quot;Assign-L72&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Octnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'0[oO](?:_?[0-7])+'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 73&quot; id=&quot;Assign-L73&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Decnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'(?:0(?:_?0)*|[1-9](?:_?[0-9])*)'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 74&quot; id=&quot;Assign-L74&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Intnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Hexnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Binnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Octnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Decnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 75&quot; id=&quot;Assign-L75&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Exponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[eE][-+]?[0-9](?:_?[0-9])*'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 76&quot; id=&quot;Assign-L76&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Pointfloat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[0-9](?:_?[0-9])*\.(?:[0-9](?:_?[0-9])*)?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                   &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'\.[0-9](?:_?[0-9])*'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maybe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 78&quot; id=&quot;Assign-L78&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Expfloat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[0-9](?:_?[0-9])*'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exponent&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 79&quot; id=&quot;Assign-L79&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Floatnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pointfloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Expfloat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 80&quot; id=&quot;Assign-L80&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Imagnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[0-9](?:_?[0-9])*[jJ]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Floatnumber&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[jJ]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 81&quot; id=&quot;Assign-L81&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Number&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Imagnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Floatnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Intnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 83&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Return the empty string, plus all of the valid string prefixes.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;_all_string_prefixes&quot; id=&quot;_all_string_prefixes&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#_all_string_prefixes&quot; role=&quot;heading&quot;&gt;_all_string_prefixes&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 85&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# The valid string prefixes. Only contain the lower case versions,&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;#  and don't contain any permutations (include 'fr', but not&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;#  'rf'). The various permutations will be generated.&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;_valid_string_prefixes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'b'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'u'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'f'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'br'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'fr'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 89&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# if we add binary f-strings, add: ['fb', 'fbr']&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_valid_string_prefixes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_itertools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;permutations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 93&quot;&gt;            &lt;span class=&quot;c1&quot;&gt;# create a list with upper and lower versions of each&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;#  character&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_itertools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;product&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]):&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@functools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lru_cache&lt;/span&gt;
&lt;span aria-label=&quot;_compile&quot; id=&quot;_compile&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#_compile&quot; role=&quot;heading&quot;&gt;_compile&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UNICODE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 103&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Note that since _all_string_prefixes includes the empty string,&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  StringPrefix can be the empty string (making it optional).&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 105&quot; id=&quot;Assign-L105&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_all_string_prefixes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 107&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Tail end of ' string.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 108&quot; id=&quot;Assign-L108&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Single&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[^'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.[^'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*)*'&quot;&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Comment Line 109&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Tail end of &quot; string.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 110&quot; id=&quot;Assign-L110&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Double&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[^&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.[^&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*)*&quot;'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Comment Line 111&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Tail end of ''' string.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 112&quot; id=&quot;Assign-L112&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Single3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[^'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*(?:(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.|'(?!''))[^'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*)*'''&quot;&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Comment Line 113&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Tail end of &quot;&quot;&quot; string.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 114&quot; id=&quot;Assign-L114&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Double3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'[^&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*(?:(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.|&quot;(?!&quot;&quot;))[^&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*)*&quot;&quot;&quot;'&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 115&quot; id=&quot;Assign-L115&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Triple&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;'''&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&quot;&quot;&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Comment Line 116&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Single-line ' or &quot; string.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 117&quot; id=&quot;Assign-L117&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;'[^\n'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.[^\n'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*)*'&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
               &lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&quot;[^\n&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.[^\n&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*)*&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 120&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# Sorting in reverse order puts the long operators before their prefixes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Otherwise if = came before ==, == would get recognized as two instances&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# of =.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 123&quot; id=&quot;Assign-L123&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Special&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;escape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sorted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXACT_TOKEN_TYPES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reverse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 124&quot; id=&quot;Assign-L124&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Funny&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'\r?\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Special&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Assign Line 126&quot; id=&quot;Assign-L126&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;PlainToken&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Funny&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 127&quot; id=&quot;Assign-L127&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Ignore&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PlainToken&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 129&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# First (or only) line of ' or &quot; string.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 130&quot; id=&quot;Assign-L130&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;ContStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;'[^\n'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.[^\n'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;]*)*&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;'&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;\r?\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;StringPrefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&quot;[^\n&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*(?:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;.[^\n&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;]*)*'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;\r?\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 134&quot; id=&quot;Assign-L134&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;PseudoExtras&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;\r?\n|\Z'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Triple&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 135&quot; id=&quot;Assign-L135&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;PseudoToken&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Whitespace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PseudoExtras&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Funny&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 137&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# For a given string prefix plus quotes, endpats maps it to a regex&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  to match the remainder of that string. _prefix can be empty, for&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  a normal single or triple quoted string (with no prefix).&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 140&quot; id=&quot;Assign-L140&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;For Line 141&quot; id=&quot;For-L141&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_prefix&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_all_string_prefixes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;'&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Single&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Double&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;'''&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Single3&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&quot;&quot;&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Double3&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 147&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# A set of all of the single and triple quoted string prefixes,&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  including the opening quotes.&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 149&quot; id=&quot;Assign-L149&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;single_quoted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;Assign Line 150&quot; id=&quot;Assign-L150&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;triple_quoted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;For Line 151&quot; id=&quot;For-L151&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_all_string_prefixes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;'&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;single_quoted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&quot;&quot;&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;'''&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;triple_quoted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Assign Line 157&quot; id=&quot;Assign-L157&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;n&quot;&gt;tabsize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;TokenError&quot; id=&quot;TokenError&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#TokenError&quot; role=&quot;heading&quot;&gt;TokenError&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ne&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;StopTokenizing&quot; id=&quot;StopTokenizing&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#StopTokenizing&quot; role=&quot;heading&quot;&gt;StopTokenizing&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ne&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;
&lt;/span&gt;

&lt;span aria-label=&quot;Untokenizer&quot; id=&quot;Untokenizer&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#Untokenizer&quot; role=&quot;heading&quot;&gt;Untokenizer&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;fm&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#Untokenizer&quot; role=&quot;heading&quot;&gt;__init__&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;

&lt;span aria-label=&quot;Untokenizer.add_whitespace&quot; id=&quot;Untokenizer.add_whitespace&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#Untokenizer.add_whitespace&quot; role=&quot;heading&quot;&gt;add_whitespace&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;ValueError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;start (&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) precedes previous end (&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;)&quot;&lt;/span&gt;
                             &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;row_offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;row_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;col_offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Untokenizer.untokenize&quot; id=&quot;Untokenizer.untokenize&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#Untokenizer.untokenize&quot; role=&quot;heading&quot;&gt;untokenize&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENCODING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENDMARKER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DEDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWLINE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_whitespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_type&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWLINE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev_col&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Untokenizer.compat&quot; id=&quot;Untokenizer.compat&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#Untokenizer.compat&quot; role=&quot;heading&quot;&gt;compat&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;toks_append&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWLINE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;prevstring&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_itertools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ENCODING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NUMBER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;

&lt;span aria-label=&quot;Comment Line 237&quot;&gt;            &lt;span class=&quot;c1&quot;&gt;# Insert a space between two consecutive strings&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;STRING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;prevstring&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;prevstring&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DEDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toknum&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWLINE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;toks_append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;startline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;toks_append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;

&lt;span aria-label=&quot;untokenize&quot; id=&quot;untokenize&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#untokenize&quot; role=&quot;heading&quot;&gt;untokenize&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;Transform tokens back into Python source code.&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    It returns a bytes object, encoded using the ENCODING&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    token, which is the first token sequence output by tokenize.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    Each element returned by the iterable must be a token sequence&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    with at least two elements, a token number and token value.  If&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    only two tokens are passed, the resulting output is poor.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    Round-trip invariant for full input:&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        Untokenized source will match input source exactly&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    Round-trip invariant for limited input:&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        # Output bytes will tokenize back to the input&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        t1 = [tok[:2] for tok in tokenize(f.readline)]&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        newcode = untokenize(t1)&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        readline = BytesIO(newcode).readline&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        t2 = [tok[:2] for tok in tokenize(readline)]&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        assert t1 == t2&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    &quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Untokenizer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;untokenize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;
&lt;/span&gt;

&lt;span aria-label=&quot;_get_normal_name&quot; id=&quot;_get_normal_name&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#_get_normal_name&quot; role=&quot;heading&quot;&gt;_get_normal_name&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;orig_enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;Imitates get_normal_name in tokenizer.c.&quot;&quot;&quot;&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 288&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# Only care about the first 12 characters.&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;enc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orig_enc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;utf-8&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startswith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;utf-8-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enc&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;latin-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;iso-8859-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;iso-latin-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; \
       &lt;span class=&quot;n&quot;&gt;enc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startswith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;latin-1-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;iso-8859-1-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;iso-latin-1-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;iso-8859-1&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orig_enc&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;detect_encoding&quot; id=&quot;detect_encoding&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#detect_encoding&quot; role=&quot;heading&quot;&gt;detect_encoding&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    The detect_encoding() function is used to detect the encoding that should&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    be used to decode a Python source file.  It requires one argument, readline,&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    in the same way as the tokenize() generator.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    It will call readline a maximum of twice, and return the encoding used&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    (as a string) and a list of any lines (left as bytes) it has read in.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    It detects the encoding from the presence of a utf-8 bom or an encoding&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    cookie as specified in pep-0263.  If both a bom and a cookie are present,&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    but disagree, a SyntaxError will be raised.  If the encoding cookie is an&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    invalid charset, raise a SyntaxError.  Note that if a utf-8 bom is found,&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    'utf-8-sig' is returned.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    If no encoding is specified, then the default of 'utf-8' will be returned.&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    &quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;vm&quot;&gt;__self__&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;AttributeError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bom_found&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'utf-8'&lt;/span&gt;
&lt;span aria-label=&quot;detect_encoding.read_or_stop&quot; id=&quot;detect_encoding.read_or_stop&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#detect_encoding.read_or_stop&quot; role=&quot;heading&quot;&gt;read_or_stop&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;StopIteration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;detect_encoding.find_cookie&quot; id=&quot;detect_encoding.find_cookie&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#detect_encoding.find_cookie&quot; role=&quot;heading&quot;&gt;find_cookie&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 329&quot;&gt;            &lt;span class=&quot;c1&quot;&gt;# Decode as UTF-8. Either the line is an encoding declaration,&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# in which case it should be pure ASCII, or it must be UTF-8&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# per default encoding.&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;line_string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;UnicodeDecodeError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;invalid or missing encoding declaration&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; for &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{!r}&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;SyntaxError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie_re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_get_normal_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lookup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;LookupError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 346&quot;&gt;            &lt;span class=&quot;c1&quot;&gt;# This behaviour mimics the Python interpreter&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;unknown encoding: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;unknown encoding for &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{!r}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;SyntaxError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bom_found&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 356&quot;&gt;                &lt;span class=&quot;c1&quot;&gt;# This behaviour mimics the Python interpreter&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'encoding problem: utf-8'&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'encoding problem for &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{!r}&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;: utf-8'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;SyntaxError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'-sig'&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;
&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_or_stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startswith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOM_UTF8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bom_found&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'utf-8-sig'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;find_cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;blank_re&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;second&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_or_stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;find_cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;

&lt;span aria-label=&quot;open&quot; id=&quot;open&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#open&quot; role=&quot;heading&quot;&gt;open&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;Open a file in read only mode using the encoding detected by&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    detect_encoding().&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    &quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_builtin_open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rb'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;detect_encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seek&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TextIOWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line_buffering&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'r'&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt;
&lt;/span&gt;

&lt;span aria-label=&quot;tokenize&quot; id=&quot;tokenize&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#tokenize&quot; role=&quot;heading&quot;&gt;tokenize&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    The tokenize() generator requires one argument, readline, which&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    must be a callable object which provides the same interface as the&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    readline() method of built-in file objects.  Each call to the function&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    should return one line of input as bytes.  Alternatively, readline&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    can be a callable function terminating with StopIteration:&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;        readline = open(myfile, 'rb').__next__  # Example of alternate readline&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    The generator produces 5-tuples with these members: the token type; the&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    token string; a 2-tuple (srow, scol) of ints specifying the row and&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    column where the token begins in the source; a 2-tuple (erow, ecol) of&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    ints specifying the row and column where the token ends in the source;&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    and the line on which the token was found.  The line passed is the&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    physical line.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    The first token sequence will always be an ENCODING token&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    which tells you which encoding was used to decode the bytes stream.&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    &quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;consumed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;detect_encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;empty&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_itertools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;repeat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rl_gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_itertools&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;consumed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tokenize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rl_gen&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;fm&quot;&gt;__next__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;

&lt;span aria-label=&quot;_tokenize&quot; id=&quot;_tokenize&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#_tokenize&quot; role=&quot;heading&quot;&gt;_tokenize&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parenlev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continued&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;numchars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'0123456789'&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;needcont&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;utf-8-sig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 440&quot;&gt;            &lt;span class=&quot;c1&quot;&gt;# BOM will already have been stripped.&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ENCODING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                                &lt;span class=&quot;c1&quot;&gt;# loop over lines in stream&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 447&quot;&gt;            &lt;span class=&quot;c1&quot;&gt;# We capture the value of the line variable here because&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# readline uses the empty string '' to signal end of input,&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# hence `line` itself will always be overwritten at the end&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# of this loop.&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;StopIteration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                            &lt;span class=&quot;c1&quot;&gt;# continued string&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;EOF in multi-line string&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strstart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;endmatch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endprog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endmatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endmatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STRING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;strstart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;needcont&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;needcont&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\r\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ERRORTOKEN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                           &lt;span class=&quot;n&quot;&gt;strstart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parenlev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continued&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# new statement&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                   &lt;span class=&quot;c1&quot;&gt;# measure leading whitespace&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;' '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tabsize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tabsize&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\f&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;# skip comments or blank lines&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;comment_token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rstrip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;COMMENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comment_token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comment_token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comment_token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:],&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;# count indents or dedents&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;INDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;IndentationError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;unindent does not match any outer indentation level&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;tokenize&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DEDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                                  &lt;span class=&quot;c1&quot;&gt;# continued statement&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;EOF in multi-line statement&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;continued&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;pseudomatch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PseudoToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pseudomatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                                &lt;span class=&quot;c1&quot;&gt;# scan for tokens&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pseudomatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numchars&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt;                 &lt;span class=&quot;c1&quot;&gt;# ordinary number&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'.'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'.'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'...'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)):&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NUMBER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parenlev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWLINE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endswith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;COMMENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;triple_quoted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;endprog&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;endmatch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endprog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endmatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                           &lt;span class=&quot;c1&quot;&gt;# all on one line&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endmatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STRING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;strstart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;# multiple lines&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

&lt;span aria-label=&quot;Comment Line 561&quot;&gt;                &lt;span class=&quot;c1&quot;&gt;# Check up to the first 3 chars of the token to see if&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;#  they're in the single_quoted set. If so, they start&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;#  a string.&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;# We're using the first 3, because we're looking for&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;#  &quot;rb'&quot; (for example) at the start of the token. If&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;#  we switch to longer prefixes, this needs to be&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;#  adjusted.&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;# Note that initial == token[:1].&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;# Also note that single quote checking must come after&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;#  triple quote checking (above).&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;single_quoted&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt;
                      &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;single_quoted&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt;
                      &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;single_quoted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                  &lt;span class=&quot;c1&quot;&gt;# continued string&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;strstart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 576&quot;&gt;                        &lt;span class=&quot;c1&quot;&gt;# Again, using the first 3 chars of the&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;#  token. This is looking for the matching end&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;#  regex for the correct type of quote&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;#  character. So it's really looking for&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;#  endpats[&quot;'&quot;] or endpats['&quot;'], by trying to&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;#  skip string prefix characters, if any.&lt;/span&gt;
&lt;/span&gt;                        &lt;span class=&quot;n&quot;&gt;endprog&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt;
                                           &lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt;
                                           &lt;span class=&quot;n&quot;&gt;endpats&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;contstr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;needcont&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;contline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                                  &lt;span class=&quot;c1&quot;&gt;# ordinary string&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STRING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isidentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;               &lt;span class=&quot;c1&quot;&gt;# ordinary name&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;                      &lt;span class=&quot;c1&quot;&gt;# continued stmt&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;continued&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'([{'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;parenlev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initial&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;')]}'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;parenlev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ERRORTOKEN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

&lt;span aria-label=&quot;Comment Line 606&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# Add an implicit NEWLINE if the input doesn't end in one&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;startswith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWLINE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;last_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indent&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;indents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]:&lt;/span&gt;                 &lt;span class=&quot;c1&quot;&gt;# pop remaining indent levels&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DEDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ENDMARKER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;

&lt;span aria-label=&quot;generate_tokens&quot; id=&quot;generate_tokens&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#generate_tokens&quot; role=&quot;heading&quot;&gt;generate_tokens&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;sd&quot;&gt;&quot;&quot;&quot;Tokenize a source reading Python code as unicode strings.&lt;/span&gt;

&lt;span class=&quot;sd&quot;&gt;    This has the same API as tokenize(), except that it expects the *readline*&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    callable to return str objects instead of bytes.&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;    &quot;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tokenize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;main&quot; id=&quot;main&quot; role=&quot;region&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;2&quot; href=&quot;#main&quot; role=&quot;heading&quot;&gt;main&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;argparse&lt;/span&gt;

&lt;span aria-label=&quot;Comment Line 625&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# Helper error handling routines&lt;/span&gt;
&lt;/span&gt;&lt;span aria-label=&quot;main.perror&quot; id=&quot;main.perror&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#main.perror&quot; role=&quot;heading&quot;&gt;perror&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;main.error&quot; id=&quot;main.error&quot; role=&quot;region&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;&lt;a aria-level=&quot;3&quot; href=&quot;#main.error&quot; role=&quot;heading&quot;&gt;error&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;: error: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;: error: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;error: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 640&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# Parse the arguments and options&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argparse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ArgumentParser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'python -m tokenize'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_argument&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'filename'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nargs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;metavar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'filename.py'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;help&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'the file to tokenize; defaults to stdin'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_argument&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'-e'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'--exact'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'exact'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store_true'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;help&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'display token names using the exact type'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parse_args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span aria-label=&quot;Comment Line 650&quot;&gt;        &lt;span class=&quot;c1&quot;&gt;# Tokenize the input&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_builtin_open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'rb'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tokenize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;stdin&amp;gt;&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tokenize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span aria-label=&quot;Comment Line 659&quot;&gt;        &lt;span class=&quot;c1&quot;&gt;# Output the tokenization&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tokens&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;token_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exact&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;token_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exact_type&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;token_range&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%-20s%-15s%-15r&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token_range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tok_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;IndentationError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TokenError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;SyntaxError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;OSError&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;KeyboardInterrupt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;interrupted&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unexpected error: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt;
&lt;/span&gt;
&lt;span aria-label=&quot;If Line 683&quot; id=&quot;If-L683&quot; role=&quot;group&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vm&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/main&gt;" width="100%">
        </iframe>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 27 cell-27-cell_type" class="cell markdown" data-index="27" data-loc="3" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 27" class="nb-anchor visually-hidden" href="#27" id="27">
        27
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-27-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-27-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-27-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-27-exec-label" class="nb-toolbar" hidden id="cell-27" name="cell-27">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-27-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-27-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-27-in-label cell-27-exec-label nb-source-label" class="nb-source" form="cell-27" id="cell-27-source" name="source" readonly rows="3">### flexible configuration

the implementation of semantic structure for html should be flexible. some settings that make sense for pure code documents would not apply for notebooks. for example, cell landmarks would be preferred to expressions level landmarks. a rough configuration of the code semantis would abide the schema below.</textarea>
       <div aria-labelledby="cell-27-in-label cell-27-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">### flexible configuration</span>

the implementation of semantic structure for html should be flexible. some settings that make sense for pure code documents would not apply for notebooks. for example, cell landmarks would be preferred to expressions level landmarks. a rough configuration of the code semantis would abide the schema below.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-27-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-27" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-27-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': '<h3><a href="#flexible-configuration">flexible configuration</a></h3>\n<p>the implementation of semantic structure for html should be flexible. some settings that make sense for pure code documents would not apply for notebooks. for example, cell landmarks would be preferred to expressions level landmarks. a rough configuration of the code semantis would abide the schema below.</p>\n'}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-27-loc" role="none">
       3
      </td>
      <td class="nb-outputs" role="none">
       <h3>
        <a href="#flexible-configuration">
         flexible configuration
        </a>
       </h3>
       <p>
        the implementation of semantic structure for html should be flexible. some settings that make sense for pure code documents would not apply for notebooks. for example, cell landmarks would be preferred to expressions level landmarks. a rough configuration of the code semantis would abide the schema below.
       </p>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 28 cell-28-cell_type" class="cell code" data-index="28" data-loc="16" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-code-label nb-cell-label cell-28-loc nb-loc-label
    cell-28-outputs-len" aria-labelledby="nb-cell-label 28" class="nb-anchor visually-hidden" href="#28" id="28">
        28
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-28-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-28-exec-label">
         15
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-28-cell_type">
        code
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-28-exec-label" class="nb-toolbar" hidden id="cell-28" name="cell-28">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-28-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-28-end" role="none">
      </td>
      <td class="nb-source" role="none">
       <textarea aria-labelledby="cell-28-in-label cell-28-exec-label nb-source-label" class="nb-source" form="cell-28" id="cell-28-source" name="source" readonly rows="16">from pydantic import BaseModel, Field

class Settings(BaseModel):
    all_expressions_are_grouped: bool = Field(
        True, description="each top level expression or statement is grouped"
    )
    functions_and_classes_are_headings: bool = Field(
        True, description="function and classes in code blocks are treated as headings"
    )
    functions_and_classes_are_landmarks: bool = Field(
        True, description="function and classes in code blocks are treated as headings"
    )
    functions_and_classes_are_labelled: bool = Field(
        True, description="function and classes in code blocks are treated as headings"
    )
JSON(Settings.schema(), root="Semantic code settings")</textarea>
       <div aria-labelledby="cell-28-in-label cell-28-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">all_expressions_are_grouped</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"each top level expression or statement is grouped"</span>
    <span class="p">)</span>
    <span class="n">functions_and_classes_are_headings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"function and classes in code blocks are treated as headings"</span>
    <span class="p">)</span>
    <span class="n">functions_and_classes_are_landmarks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"function and classes in code blocks are treated as headings"</span>
    <span class="p">)</span>
    <span class="n">functions_and_classes_are_labelled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"function and classes in code blocks are treated as headings"</span>
    <span class="p">)</span>
<span class="n">JSON</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">schema</span><span class="p">(),</span> <span class="n">root</span><span class="o">=</span><span class="s2">"Semantic code settings"</span><span class="p">)</span>
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-28-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-28" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-28-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-28-loc" role="none">
       16
      </td>
      <td class="nb-outputs" role="none">
       <span class="nb-outputs visually-hidden" id="cell-28-outputs-len">
        1 outputs.
       </span>
       <fieldset class="nb-outputs" data-outputs="1">
        <legend aria-describedby="nb-outputs-desc" hidden id="cell-28-outputs-label">
         <span>
          Out
         </span>
         <span aria-hidden="true">
          [
         </span>
         <span>
          15
         </span>
         <span aria-hidden="true">
          ]
         </span>
        </legend>
        <pre class="plain">&lt;IPython.core.display.JSON object&gt;</pre>
       </fieldset>
      </td>
     </tr>
     <tr aria-labelledby="nb-cell-label 29 cell-29-cell_type" class="cell markdown" data-index="29" data-loc="8" data-slide_type role="listitem">
      <th class="nb-anchor" role="none" scope="row">
       <a aria-describedby="nb-markdown-label nb-cell-label " aria-labelledby="nb-cell-label 29" class="nb-anchor visually-hidden" href="#29" id="29">
        29
       </a>
      </th>
      <td class="nb-execution_count" hidden role="none">
       <label class="nb-execution_count">
        <span id="cell-29-in-label">
         In
        </span>
        <span aria-hidden="true">
         [
        </span>
        <span id="cell-29-exec-label">
        </span>
        <span aria-hidden="true">
         ]
        </span>
       </label>
      </td>
      <td class="nb-cell_type" hidden role="none">
       <label id="cell-29-cell_type">
        markdown
       </label>
      </td>
      <td class="nb-toolbar" hidden role="none">
       <form aria-labelledby="cell-29-exec-label" class="nb-toolbar" hidden id="cell-29" name="cell-29">
        <fieldset>
         <legend>
          actions
         </legend>
         <button type="submit">
          Run Cell
         </button>
        </fieldset>
       </form>
      </td>
      <td class="nb-start" hidden id="cell-29-start" role="none">
      </td>
      <td class="nb-end" hidden id="cell-29-end" role="none">
      </td>
      <td class="nb-source" hidden role="none">
       <textarea aria-labelledby="cell-29-in-label cell-29-exec-label nb-source-label" class="nb-source" form="cell-29" id="cell-29-source" name="source" readonly rows="8">## conclusions

* all of this is hand wavy bullshit cause i'm the only disabled person to test this and i'm not an experienced screen reader user.
* some structure is better, too much structure would be bad.
* reading code is a more practical literacy than writing code. assistive technology users should have an easier time reading code.
* for long code documents, line numbers are challenging to navigate with a screen reader. better semantics can improve code navigation.
* the visual structure of the annotation object model is more navigable.
* audibly, this is better for me when testing notebooks on a screen reader. code cells with more than 5 lines of code are garbled and unstructured. more structure and interactive elements can improve the comprehension of coded elements.</textarea>
       <div aria-labelledby="cell-29-in-label cell-29-exec-label" aria-roledescription="highlighted" role="group">
        <div class="highlight">
         <pre><span></span><code><span class="gu">## conclusions</span>

<span class="k">*</span><span class="w"> </span>all of this is hand wavy bullshit cause i'm the only disabled person to test this and i'm not an experienced screen reader user.
<span class="k">*</span><span class="w"> </span>some structure is better, too much structure would be bad.
<span class="k">*</span><span class="w"> </span>reading code is a more practical literacy than writing code. assistive technology users should have an easier time reading code.
<span class="k">*</span><span class="w"> </span>for long code documents, line numbers are challenging to navigate with a screen reader. better semantics can improve code navigation.
<span class="k">*</span><span class="w"> </span>the visual structure of the annotation object model is more navigable.
<span class="k">*</span><span class="w"> </span>audibly, this is better for me when testing notebooks on a screen reader. code cells with more than 5 lines of code are garbled and unstructured. more structure and interactive elements can improve the comprehension of coded elements.
</code></pre>
        </div>
       </div>
      </td>
      <td class="nb-metadata" hidden role="none">
       <button aria-controls="cell-29-metadata" aria-describedby="nb-metadata-desc" class="nb-metadata" form="cell-29" name="metadata" onclick="openDialog()">
        metadata
       </button>
       <dialog id="cell-29-metadata">
        <form>
         <button formmethod="dialog">
          Close
         </button>
         <pre><code>
        {'data': {'text/html': "<h2><a href="#conclusions">conclusions</a></h2>\n<ul>\n<li>all of this is hand wavy bullshit cause i'm the only disabled person to test this and i'm not an experienced screen reader user.</li>\n<li>some structure is better, too much structure would be bad.</li>\n<li>reading code is a more practical literacy than writing code. assistive technology users should have an easier time reading code.</li>\n<li>for long code documents, line numbers are challenging to navigate with a screen reader. better semantics can improve code navigation.</li>\n<li>the visual structure of the annotation object model is more navigable.</li>\n<li>audibly, this is better for me when testing notebooks on a screen reader. code cells with more than 5 lines of code are garbled and unstructured. more structure and interactive elements can improve the comprehension of coded elements.</li>\n</ul>\n"}}
        </code></pre>
        </form>
       </dialog>
      </td>
      <td class="nb-loc" hidden id="cell-29-loc" role="none">
       8
      </td>
      <td class="nb-outputs" role="none">
       <h2>
        <a href="#conclusions">
         conclusions
        </a>
       </h2>
       <ul>
        <li>
         all of this is hand wavy bullshit cause i'm the only disabled person to test this and i'm not an experienced screen reader user.
        </li>
        <li>
         some structure is better, too much structure would be bad.
        </li>
        <li>
         reading code is a more practical literacy than writing code. assistive technology users should have an easier time reading code.
        </li>
        <li>
         for long code documents, line numbers are challenging to navigate with a screen reader. better semantics can improve code navigation.
        </li>
        <li>
         the visual structure of the annotation object model is more navigable.
        </li>
        <li>
         audibly, this is better for me when testing notebooks on a screen reader. code cells with more than 5 lines of code are garbled and unstructured. more structure and interactive elements can improve the comprehension of coded elements.
        </li>
       </ul>
      </td>
     </tr>
    </tbody>
   </table>
  </main>
  <footer>
   <a href="2023-08-23-semantic-lits.html" rel="prev&gt;&lt;span aria-hidden=" true">
    &lt;semantically meaningful lists
   </a>
   <br>
   <a href="2023-08-03-pandas-accessors.html" rel="next">
    pandas accessors
    <span aria-hidden="true">
     &gt;
    </span>
   </a>
   <br>
   <form aria-labelledby="nb-notebook-label" hidden id="notebook" name="notebook">
    <label>
     <input id="nb-edit-mode" name="edit" type="checkbox">
     edit mode
    </label>
    <button type="submit">
     Run
    </button>
   </form>
   <button accesskey="-" aria-controls="nb-visibility-dialog" onclick="openDialog()">
    show/hide
   </button>
   <button accesskey="?" aria-controls="nb-help" onclick="openDialog()">
    help
   </button>
   <dialog id="nb-settings">
    <form name="settings">
     <h1 id="nb-accessibility-settings-label">
      <a href="#nb-accessibility-settings-label">
       accessibility settings
      </a>
     </h1>
     <button formmethod="dialog">
      Close
     </button>
     <ul aria-labelledby="nb-accessibility-settings-label">
      <li>
       <h2 id="nb-notebook-layout-label">
        <a href="#nb-notebook-layout-label">
         notebook layout
        </a>
       </h2>
       <ul aria-labelledby="nb-notebook-layout-label">
        <li>
         <label id="nb-color-scheme-select">
          color scheme
          <select name="color-scheme">
           <option selected value="light">
            light mode
           </option>
           <option value="dark">
            dark mode
           </option>
          </select>
         </label>
        </li>
        <li>
         <label>
          <input name="horizontal-scrolling" type="checkbox">
          horizontal scrolling
         </label>
        </li>
        <li>
         <label>
          line height
          <input max="3" min="0.5" name="line-height" step="0.1" type="number" value="1.5">
         </label>
        </li>
        <li>
         <label id="nb-cell-navigation-select">
          cell navigation
          <select name="cell-navigation">
           <option selected value="list">
            list
           </option>
           <option value="table">
            table
           </option>
           <option value="region">
            region
           </option>
           <option value="presentation">
            presentation
           </option>
           <option disabled value="grid">
            grid
           </option>
           <option disabled value="treegrid">
            treegrid
           </option>
           <option disabled value="tree">
            tree
           </option>
          </select>
         </label>
        </li>
        <li>
         <label id="nb-accessibility-priority-select">
          accessibility priority
          <select name="accessibility-priority">
           <option value="AAA">
            Triple A
           </option>
           <option value="AA">
            Double A
           </option>
           <option value="A">
            Single A
           </option>
          </select>
         </label>
        </li>
        <li>
         <label>
          margin
          <input max="40" min="0" name="margin" step="5" type="number" value="5">
          %
         </label>
        </li>
        <li>
         <label>
          <input checked name="accesskey-navigation" type="checkbox">
          accesskey navigation
         </label>
        </li>
       </ul>
      </li>
      <li>
       <h2 id="nb-font-settings-label">
        <a href="#nb-font-settings-label">
         font settings
        </a>
       </h2>
       <ul aria-labelledby="nb-font-settings-label">
        <li>
         <label id="nb-font-size-select">
          font size
          <select name="font-size">
           <option value="xx-small">
            xx-small
           </option>
           <option value="x-small">
            x-small
           </option>
           <option value="small">
            small
           </option>
           <option selected value="medium">
            medium
           </option>
           <option value="120%">
            large
           </option>
           <option value="150%">
            x-large
           </option>
           <option value="200%">
            xx-large
           </option>
           <option value="300%">
            xxx-large
           </option>
           <option value="400%">
            xxxx-large
           </option>
           <option value="500%">
            xxxxx-large
           </option>
          </select>
         </label>
        </li>
        <li>
         <label id="nb-font-family-select">
          font family
          <select name="font-family">
           <option selected value="serif">
            serif
           </option>
           <option value="sans-serif">
            sans-serif
           </option>
          </select>
         </label>
        </li>
       </ul>
      </li>
      <li>
       <h2 id="nb-sound-settings-label">
        <a href="#nb-sound-settings-label">
         sound settings
        </a>
       </h2>
       <ul aria-labelledby="nb-sound-settings-label">
        <li>
         <label>
          <input name="synthetic-speech" type="checkbox">
          synthetic speech
         </label>
        </li>
        <li>
         <label>
          <input checked name="aria-live" type="checkbox">
          aria live
         </label>
        </li>
       </ul>
      </li>
     </ul>
     <details class="log">
      <summary>
       <span>
        activity log
       </span>
      </summary>
     </details>
     <table aria-labelledby="nb-activity-log-label" aria-live="polite">
      <tbody>
       <tr>
        <th hidden>
         time
        </th>
        <td>
         message
        </td>
       </tr>
      </tbody>
     </table>
    </form>
   </dialog>
   <dialog id="nb-visibility-dialog">
    <form name="visibility">
     <button formmethod="dialog">
      Close
     </button>
     <label>
      <input name="visually-hide" type="checkbox">
      visually hide
     </label>
     <fieldset disabled>
      <legend>
       visibility
      </legend>
      <table aria-label="notebook cell visibility" role="grid">
       <tbody>
        <tr>
         <th>
         </th>
         <th>
          index
         </th>
         <th>
          execution_count
         </th>
         <th>
          cell_type
         </th>
         <th>
          source
         </th>
         <th>
          outputs
         </th>
         <th>
          metadata
         </th>
         <th>
          toolbar
         </th>
         <th>
          loc
         </th>
        </tr>
        <tr class="code">
         <td>
          code
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-index-label" checked name="index" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-execution_count-label" checked name="execution_count" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-cell_type-label" name="cell_type" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-source-label" checked name="source" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-outputs-label" checked name="outputs" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-metadata-label" name="metadata" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-toolbar-label" name="toolbar" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-loc-label" name="loc" type="checkbox">
         </td>
        </tr>
        <tr class="markdown">
         <td>
          markdown
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-index-label" checked name="index" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-execution_count-label" checked name="execution_count" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-cell_type-label" name="cell_type" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-source-label" checked name="source" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-outputs-label" checked name="outputs" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-metadata-label" name="metadata" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-toolbar-label" name="toolbar" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-loc-label" name="loc" type="checkbox">
         </td>
        </tr>
        <tr class="raw">
         <td>
          raw
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-index-label" checked name="index" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-execution_count-label" checked name="execution_count" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-cell_type-label" name="cell_type" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-source-label" checked name="source" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-outputs-label" checked name="outputs" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-metadata-label" name="metadata" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-toolbar-label" name="toolbar" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-loc-label" name="loc" type="checkbox">
         </td>
        </tr>
       </tbody>
      </table>
     </fieldset>
    </form>
    <form name="expanded">
     <fieldset disabled>
      <legend>
       expand/collapse
      </legend>
      <table role="grid">
       <tbody>
        <tr>
         <th>
         </th>
         <th>
          cell
         </th>
         <th>
          source
         </th>
         <th>
          outputs
         </th>
        </tr>
        <tr class="code">
         <td>
          code
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-cell-label" checked name="cell" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-source-label" checked name="source" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-code-label nb-outputs-label" checked name="outputs" type="checkbox">
         </td>
        </tr>
        <tr class="markdown">
         <td>
          markdown
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-cell-label" checked name="cell" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-source-label" checked name="source" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-markdown-label nb-outputs-label" checked name="outputs" type="checkbox">
         </td>
        </tr>
        <tr class="raw">
         <td>
          raw
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-cell-label" checked name="cell" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-source-label" checked name="source" type="checkbox">
         </td>
         <td>
          <input aria-labelledby="nb-raw-label nb-outputs-label" checked name="outputs" type="checkbox">
         </td>
        </tr>
       </tbody>
      </table>
     </fieldset>
    </form>
    <details class="log">
     <summary>
      <span>
       activity log
      </span>
     </summary>
    </details>
    <table aria-labelledby="nb-activity-log-label" aria-live="polite">
     <tbody>
      <tr>
       <th hidden>
        time
       </th>
       <td>
        message
       </td>
      </tr>
     </tbody>
    </table>
   </dialog>
   <dialog id="nb-help">
    <h1>
     <a href="#notebook-help">
      notebook help
     </a>
    </h1>
    <form>
     <button formmethod="dialog">
      close
     </button>
     <h2 id="nb-defs-label">
      <a href="#nb-defs-label">
       definitions
      </a>
     </h2>
     <dl aria-labelledby="nb-defs-label">
      <dt id="nb-notebook-label">
       notebook
      </dt>
      <dd>
       a collections of
       <a href="#nb-cells-label">
        cells
       </a>
      </dd>
      <dd>
       <dl aria-labelledby="nb-notebook-label nb-defs-label">
        <dt id="nb-root-metadata-label">
         metadata
        </dt>
        <dd id="nb-root-metadata-desc">
         Notebook root-level metadata.
        </dd>
        <dd>
         <dl>
          <dt id="nb-kernelspec-label">
           kernelspec
          </dt>
          <dd>
           Kernel information.
          </dd>
          <dd>
           <dl aria-labelledby="nb-kernelspec-label">
            <dt>
             kernel name
            </dt>
            <dd>
             Name of the kernel specification.
            </dd>
            <dt>
             display name
            </dt>
            <dd>
             Name to display in UI.
            </dd>
           </dl>
          </dd>
          <dt id="nb-language_info-label">
           language info
          </dt>
          <dd>
           Kernel information.
          </dd>
          <dd>
           <dl aria-labelledby="nb-language_info-label">
            <dt>
             programming language
            </dt>
            <dd>
             The programming language which this kernel runs.
            </dd>
            <dt>
             <a>
              codemirror mode
             </a>
            </dt>
            <dd>
             The codemirror mode to use for code in this language.
            </dd>
            <dt>
             file extension
            </dt>
            <dd>
             The file extension for files in this language.
            </dd>
            <dt>
             mimetype
            </dt>
            <dd>
             The mimetype corresponding to files in this language.
            </dd>
            <dt>
             pygments lexer
            </dt>
            <dd>
             The pygments lexer to use for code in this language.
            </dd>
           </dl>
          </dd>
          <dt>
           title
          </dt>
          <dd>
           The title of the notebook document
          </dd>
          <dt>
           authors
          </dt>
          <dd>
           The author(s) of the notebook document
          </dd>
         </dl>
        </dd>
        <dt id="nb-cells-label">
         cells
        </dt>
        <dd id="nb-cells-desc">
         Array of cells of the current notebook.
        </dd>
       </dl>
      </dd>
      <dt id="nb-cell-label">
       cell
      </dt>
      <dd>
       <dl aria-labelledby="nb-cell-label nb-defs-label">
        <dt id="nb-index-label">
         index
        </dt>
        <dd id="nb-index-desc">
         the ordinal location of the cell in the notebook, counting begins from 1.
        </dd>
        <dt id="nb-source-label">
         source
        </dt>
        <dd id="nb-source-desc">
         Contents of the cell, represented as an array of lines.
        </dd>
        <dt id="nb-metadata-label">
         metadata
        </dt>
        <dd id="nb-metadata-desc">
         Cell-level metadata.
        </dd>
        <dd>
         <dl aria-labelledby="nb-metadata-label">
          <dt>
           name
          </dt>
          <dd>
          </dd>
          <dt>
           tags
          </dt>
          <dd>
          </dd>
          <dt id="nb-jupyter-label">
           jupyter
          </dt>
          <dd id="nb-jupyter-desc">
           Official Jupyter Metadata for Raw Cells
          </dd>
          <dd>
           <dl>
            <dt>
             source hidden
            </dt>
            <dd>
             Whether the source is hidden.
            </dd>
            <dt>
             outputs hidden
            </dt>
            <dd>
             Whether the outputs are hidden.
            </dd>
            <dt id="nb-execution-label">
             execution
            </dt>
            <dd id="nb-execution-desc">
             Execution time for the code in the cell. This tracks time at which messages are received from iopub or shell channels
            </dd>
            <dd>
             <dl aria-labelledby="nb-execution-label">
              <dt>
               execute input
              </dt>
              <dd>
               {'description': "header.date (in ISO 8601 format) of iopub channel's execute_input message. It indicates the time at which the kernel broadcasts an execute_input message to connected frontends", 'type': 'string'}
              </dd>
              <dt>
               execute reply
              </dt>
              <dd>
              </dd>
             </dl>
            </dd>
            <dt>
             collapsed
            </dt>
            <dd>
             Whether the cell's output is collapsed/expanded.
            </dd>
            <dt>
             scrolled
            </dt>
            <dd>
             Whether the cell's output is scrolled, unscrolled, or autoscrolled.
            </dd>
           </dl>
          </dd>
         </dl>
        </dd>
        <dt id="nb-cell_type-label">
         cell type
        </dt>
        <dd>
         the are three kinds of cells
         <dl aria-labelledby="nb-cell_type-label">
          <dt id="nb-code-label">
           code
          </dt>
          <dd id="nb-code-desc">
           Notebook code cell.
          </dd>
          <dt id="nb-markdown-label">
           markdown
          </dt>
          <dd id="nb-markdown-desc">
           Notebook markdown cell.
          </dd>
          <dt id="nb-raw-label">
           raw
          </dt>
          <dd id="nb-raw-desc">
           Notebook raw nbconvert cell.
          </dd>
         </dl>
        </dd>
        <dd id="nb-cell_type-desc">
         String identifying the type of cell.
        </dd>
        <dt id="nb-execution_count-label">
         execution count
        </dt>
        <dd id="nb-execution_count-desc">
         The code cell's prompt number. Will be null if the cell has not been run.
        </dd>
        <dt id="nb-outputs-label">
         outputs
        </dt>
        <dd id="nb-outputs-desc">
         Execution, display, or stream outputs.
        </dd>
        <dt id="nb-attachments-label">
         attachments
        </dt>
        <dd id="nb-attachments-desc">
         Media attachments (e.g. inline images), stored as mimebundle keyed by filename.
        </dd>
        <dt>
         lines of code
        </dt>
        <dd>
         lines of code in the cell, including whitespace.
        </dd>
       </dl>
      </dd>
      <dt id="nb-toolbar-label">
       toolbar
      </dt>
      <dd>
       composite widgets that allow for arrow key navigation
      </dd>
     </dl>
    </form>
   </dialog>
   <details class="log">
    <summary>
     <span id="nb-activity-log-label">
      activity log
     </span>
    </summary>
   </details>
   <table aria-labelledby="nb-activity-log-label" aria-live="polite">
    <tbody>
     <tr>
      <th hidden>
       time
      </th>
      <td>
       message
      </td>
     </tr>
    </tbody>
   </table>
   <a accesskey="0" href="#TOP">
    skip to top
   </a>
  </footer>
  <script>
   const BODY = document.querySelector("body"), SELECTORS = {
    "table": "table#cells",
    "body": "table#cells>tbody",
    "row": "table#cells>tbody>tr",
    "header": "table#cells>tbody>tr>th",
    "cell": "table#cells>tbody>tr>td",
}, ROLES = {
    "list": {
        "table": "presentation",
        "body": "list",
        "row": "listitem",
        "header": "none",
        "cell": "none",
    }, "table": {
        "table": "table",
        "body": "rowgroup",
        "row": "row",
        "header": "rowheader",
        "cell": "cell",
    }, "region": {
        "table": "presentation",
        "body": "presentation",
        "row": "region",
        "header": "none",
        "cell": "none",
    }, "presentation": {
        "table": "presentation",
        "body": "none",
        "row": "none",
        "header": "none",
        "cell": "none",
    }
};

function toggleColorScheme(value = null) {
    value = value === null ? document.forms.settings.elements["color-scheme"].value : value;
    let DARK = value == "dark";
    let opposite = DARK ? "light" : "dark";
    document.getElementById(`nb-${value}-highlight`).removeAttribute("media", "screen");
    document.getElementById(`nb-${opposite}-highlight`).setAttribute("media", "not screen");
    document.querySelector(`head > meta[name="color-scheme"]`).setAttribute("content", value);
    BODY.classList.toggle("dark", DARK);
    activityLog(`${value} mode activated`)
}
function toggleRole() {
    let value = document.forms.settings["cell-navigation"].value;
    for (const [k, selector] of Object.entries(SELECTORS)) {
        document.querySelectorAll(selector).forEach(
            (x) => {
                if (ROLES[value][k] == null) {
                    x.removeAttribute("role")
                } else {
                    x.setAttribute("role", ROLES[value][k])
                }
            }
        );
    }
    activityLog(`notebook cell navigation set to ${event.target.value}.`);
}
function flattenCss(x) {
    return Object.entries(x).map(x => x.join(": ")).join("; ");
}
function getStyle() {
    return {
        "--nb-font-size": document.forms.settings["font-size"].value,
        "--nb-font-family": document.forms.settings["font-family"].value,
        "--nb-margin": `${document.forms.settings.elements.margin.value}%`,
        "--nb-line-height": `${document.forms.settings.elements["line-height"].value}`,
    }
}
function setStyle(msg) {
    BODY.setAttribute("style", flattenCss(getStyle()));
    setWCAG(); toggleColorScheme(); toggleColorScheme();
    activityLog(msg);
}
function changeFont() {
    document.forms.settings["font-size"].value;
    setStyle(`font size change`);
}
function changeFontFamily() {
    let value = document.forms.settings["font-family"].value;
    setStyle(value == "serif" ? `serifs included` : `serifs removed`)
}
function activityLog(msg, silent = false, first = false) {
    document.querySelectorAll("details.log+table").forEach(
        (body, i) => {
            let tr = document.createElement("tr"),
                th = document.createElement("th"),
                time = document.createElement("time"),
                td = document.createElement("td"),
                out = document.createElement("output"),
                now = Date.now();
            time.setAttribute("datetime", now), th.setAttribute("aria-live", "off"), th.setAttribute("hidden", null);
            time.textContent = now;
            body.append(tr), th.append(time), tr.append(th), tr.append(td), td.append(out);
            silent ? out.setAttribute("aria-live", "off") : null;
            out.textContent = msg;
            if (!i && document.forms.settings.elements["synthetic-speech"].checked) {
                // a non-screen reader solution for audible activity.
                speechSynthesis.speak(new SpeechSynthesisUtterance(msg));
            }
        }
    );
};
function openDialog() {
    event.preventDefault();
    document.getElementById(event.target.getAttribute("aria-controls")).showModal();
};
const L = 37, U = 38, R = 39, D = 40;
document.querySelectorAll("table[role=grid]").forEach(
    (x) => {
        x.addEventListener("keydown", (e) => {
            let target = document.activeElement;
            let i = Array.prototype.indexOf.call(target.parentElement.parentElement.childNodes, target.parentElement);
            switch (e.code) {
                case L:
                    break
                case U:
                    break
                case R:
                    break
                case D:
                    break
            };
        })
    }
);
document.forms.settings.elements["cell-navigation"].addEventListener("change", toggleRole)

document.forms.settings.elements["color-scheme"].addEventListener("change", toggleColorScheme);
document.forms.settings.elements["font-size"].addEventListener("change", (x) => {
    setStyle("change font size");
});
document.forms.settings.elements["font-family"].addEventListener("change", changeFontFamily);
document.forms.settings.elements["synthetic-speech"].addEventListener("change", (x) => {
    activityLog("speech on")
});
document.forms.settings.elements.margin.addEventListener("change", (x) => {
    setStyle("margin changed");
});
document.forms.settings.elements["line-height"].addEventListener("change", (x) => {
    setStyle("line height changed");
});
function setWCAG() {
    var priority = document.forms.settings["accessibility-priority"].value.toLowerCase();
    ["a", "aa", "aaa"].forEach(
        (x) => {
            if (x == priority) {
                BODY.classList.add(`wcag-${x}`)
            } else {
                BODY.classList.remove(`wcag-${x}`)
            }
        }
    );
}
document.forms.settings.elements["accessibility-priority"].addEventListener("change", setWCAG);
function toggleActive() {
    if (document.forms.notebook.elements.edit.checked) {
        document.querySelectorAll("tr.cell>td>details>summary[inert]").forEach(
            x => x.removeAttribute("inert")
        );
        document.querySelectorAll("tr.cell>td>details>textarea[readonly]").forEach(
            x => x.removeAttribute("readonly")
        );
        document.querySelectorAll("tr.cell>td>form").forEach(
            x => x.removeAttribute("hidden")
        );
        activityLog("entering edit mode");
    } else {
        document.querySelectorAll("tr.cell>td>details>summary").forEach(
            x => x.setAttribute("inert", null)
        );
        document.querySelectorAll("tr.cell>td>details>textarea").forEach(
            x => x.setAttribute("readonly", null)
        );
        document.querySelectorAll("tr.cell>td>form").forEach(
            x => x.setAttribute("hidden", null)
        );
        activityLog("entering reading mode");
    }
}


document.forms.notebook.elements.edit.addEventListener("change", () => toggleActive())

function openDialogs() {
    let trigger = document.querySelector("#nb-dialogs > details");
    Array.from(
        document.querySelectorAll("#nb-dialogs dialog:not(.log)")
    ).reverse().forEach(
        x => {
            trigger.getAttribute("open") === null ? x.show() : x.close();
        }
    );
    event.target.focus();
}

document.forms.visibility['visually-hide'].addEventListener("change",
    (x) => {
        document.querySelector("main").classList.toggle("visually-hide");
        activityLog(`${event.target.checked ? "hiding" : "showing"} main content`);
    });

document.forms.settings['horizontal-scrolling'].addEventListener("change",
    (x) => {
        BODY.classList.toggle("horiz-overflow", event.target.checked);
        if (!event.target.checked) {
            document.querySelectorAll("textarea").forEach(
                (x) => {
                    x.style.width = "";
                    x.style.height = "";
                }
            )
        };
        // activityLog(`${event.target.checked ? "overflow scrol" : "showing"} main content`);
    });


function fullScreen() {
    if (!document.fullscreenElement) {
        document.querySelector("main").requestFullscreen();
    } else {
        document.exitFullscreen();
    }
}

// resizing hits the width before the height.
// width resizes trigger height resizes and height resizes need to be computed from scratch.
// we handle that logic with boolean flags when sets the width/height.
function setTextareaWidth(entry, set = null) {
    if (set === null) { return }
    if (set) {
        entry.target.style.width = "";
        let props = getComputedStyle(entry.target);
        let width = entry.target.scrollWidth,
            left = Number(props.borderLeftWidth.slice(0, -2)),
            right = Number(props.borderRightWidth.slice(0, -2));
        entry.target.style.width = `${Math.ceil(width) + Math.ceil(left) + Math.ceil(right) + 1}px`
        setTextareaHeight(entry, true);
    }
}

function setTextareaHeight(entry, reset = null) {
    if (reset === null) { return }
    let props = getComputedStyle(entry.target);
    if (reset) {
        entry.target.style.height = ""
        return setTextareaHeight(entry, false)
    } else {
        let height = entry.target.scrollHeight;
        let top = Number(props.borderTopWidth.slice(0, -2));
        let bottom = Number(props.borderBottomWidth.slice(0, -2));
        entry.target.style.height = `${Math.ceil(height) + Math.ceil(top) + Math.ceil(bottom) + 1}px`;
    }

}
let observer = new ResizeObserver(
    (entries) => {
        entries.forEach((entry) => {
            (BODY.matches(".horiz-overflow") ? setTextareaWidth : setTextareaHeight)(entry, true);
        });
    }
);

document.querySelectorAll("textarea").forEach(
    (x) => {
        observer.observe(x);
    }
);

if (!document.fullscreenEnabled) {
    document.getElementById("nb-fullscreen").setAttribute("hidden", "");
}

setStyle("initialize saved settings.")
// async function runSource(target) {
//     {
//         let pyodide = await loadPyodide();
//         pyodide.runPython(target.elements.source.value).then(
//             (x) => {
//                 console.log(x)
//             }, (x) => {
//                 console.log(x)
//             }
//         )
//         return false;
//     }
// }
// document.querySelectorAll("form.nb-toolbar").forEach((x) => {
//     x.addEventListener("submit", (event) => {
//         event.preventDefault();
//     })
// });
// document.querySelectorAll("textarea[name=source]").forEach(
//     (x) => {
//         x.addEventListener("keydown", (event) => {
//             if (event.ctrlKey && event.key === 'Enter') {
//                 runSource(event.target.form);
//             }
//         })
//     }
// );
  </script>
  <script type="application/vnd.jupyter.widget-state+json">
   {"state": {}, "version_major": 2, "version_minor": 0}
  </script>
 </body>
</html>
